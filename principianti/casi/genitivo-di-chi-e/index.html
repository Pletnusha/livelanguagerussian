<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GENITIVO ‚Äî DI CHI √à? - LIVE LANGUAGE RUSSIAN</title>
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=League+Spartan:wght@700&family=Montserrat:wght@400;600&display=swap" rel="stylesheet">

    <!-- ============================================================
         TEMPORARY: Hide paid/locked UI elements
         Page: accusativo-come-ti-chiami
         To re-enable: Remove this entire <style> block
         ============================================================ -->
    <style>
        /* Hide the unlock CTA section */
        .cta-section {
            display: none !important;
        }

        /* Blocked panel state - visible but non-interactive */
        .exercise-panel[data-state="blocked"] {
            position: relative;
            pointer-events: none;
            opacity: 0.5;
            filter: grayscale(0.3);
        }

        .exercise-panel[data-state="blocked"]::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: transparent;
            z-index: 100;
        }

        /* Exercise card blocked state indicator */
        .exercise-card[data-card-state="blocked"] {
            opacity: 0.6;
            cursor: not-allowed;
        }
    </style>
    <!-- END: Hide paid/locked UI elements -->

</head>
<body class="page-accusativo-come-ti-chiami">

    <header class="page-header">
        <a href="/principianti.html" class="back-link">‚Üê Torna indietro</a>
    </header>

    <section class="argomento-header">
        <h1 class="argomento-title">IL GENITIVO <br> DI APARTENENZA</h1>
        <p class="argomento-focus">  Di chi √®? –ß—å—ë —ç—Ç–æ?</p>
    </section>

    <section class="argomento-intro">
        <p>In questa unit√† imparerai a <br> riconoscere ed esprimere <br> il genitivo di appartenenza in modo chiaro e naturale.</p>
    </section>

    <main class="exercises-section">

        <article class="exercise-card" data-status="open" data-target="panel-acc-open-1">
            <span class="exercise-type">Drag &amp; Drop</span>
            <h3 class="exercise-title"> –î–†–£–ì –ï–Å –ë–†–ê–¢–ê</h3>
        </article>

        <div class="exercise-panel" id="panel-acc-open-1" data-access="public" hidden>
            <section id="ex-accusativo-trascina-01" class="universal-dd">
                <div id="ex-accusativo-trascina-01-container"></div>
                <div id="ex-accusativo-trascina-01-completion" style="display:none;"></div>
            </section>

            <script type="text/plain" data-lazy-script="panel-acc-open-1">
(() => {
    const root = document.getElementById('ex-accusativo-trascina-01');
    const exerciseContainer = root.querySelector('#ex-accusativo-trascina-01-container');
    const completionScreen = root.querySelector('#ex-accusativo-trascina-01-completion');

    const exercises = [
        {
            instruction: "Completa la frase scegliendo la forma corretta",
            text: " –ê–Ω—Ç–æ–Ω –±—Ä–∞—Ç {{1}}.",
            words: ["–ê–ª–µ–∫—Å–∞–Ω–¥—Ä—ã", "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä", "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞"],
            correctAnswers: { 1: "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞"}
        },
        {
            instruction: "Completa la frase scegliendo la forma corretta",
            text: "–ï–ª–µ–Ω–∞ —Å–µ—Å—Ç—Ä–∞ {{1}} .",
            words: ["–í–ª–∞–¥–∏—Å–ª–∞–≤–∞", "–í–ª–∞–¥–∏—Å–ª–∞–≤", "–í–ª–∞–¥–∏—Å–ª–∞–≤—É"],
            correctAnswers: { 1: "–í–ª–∞–¥–∏—Å–ª–∞–≤–∞" }
        },
        {
            instruction: "Completa la frase scegliendo la forma corretta",
            text: "–ê–Ω–Ω–∞ –∂–µ–Ω–∞{{1}} .",
            words: ["–ê–Ω–∞—Ç–æ–ª–∏–π", "–ê–Ω–∞—Ç–æ–ª–∏–π–∞", "–ê–Ω–∞—Ç–æ–ª–∏—è"],
            correctAnswers: { 1: "–ê–Ω–∞—Ç–æ–ª–∏—è" }
        },
        {
            instruction: "Completa la frase scegliendo la forma corretta",
            text: "–õ–∏–∑–∞ —Å–µ—Å—Ç—Ä–∞ {{1}} .",
            words: ["–ê–Ω—Ç–æ–Ω—É", "–ê–Ω—Ç–æ–Ω–∞", "–ê–Ω—Ç–æ–Ω"],
            correctAnswers: { 1: "–ê–Ω—Ç–æ–Ω–∞" }
        },
        {
            instruction: "Completa la frase scegliendo la forma corretta",
            text: " –î–µ–≤—É—à–∫–∞ {{1}} ",
            words: ["–Ω–∞—à —Å–æ—Å–µ–¥", "–Ω–∞—à–µ–≥–æ —Å–æ—Å–µ–¥–∞", "–Ω–∞—à—É —Å–æ—Å–µ–¥–∞"],
            correctAnswers: { 1: "–Ω–∞—à–µ–≥–æ —Å–æ—Å–µ–¥–∞" }
        },
        {
            instruction: "Completa la frase scegliendo la forma corretta",
            text: " –°–æ–±–∞–∫–∞ {{1}} .",
            words: ["–º–æ—ë –ø–∞—Ä–Ω—è", "–º–æ–µ–≥–æ –ø–∞—Ä–µ–Ω—å—è", "–º–æ–µ–≥–æ –ø–∞—Ä–Ω—è"],
            correctAnswers: { 1: "–º–æ–µ–≥–æ –ø–∞—Ä–Ω—è" }
        },
        {
            instruction: "Completa la frase scegliendo la forma corretta",
            text: " –ú–∞—à–∏–Ω–∞ {{1}}.",
            words: ["–º–æ–π –¥—Ä—É–≥", "–º–æ–µ–≥–æ –¥—Ä—É–≥—É", "–º–æ–µ–≥–æ –¥—Ä—É–≥–∞"],
            correctAnswers: { 1: "–º–æ–µ–≥–æ –¥—Ä—É–≥–∞" }
        },
        {
            instruction: "Completa la frase scegliendo la forma corretta",
            text: "–î—Ä—É–≥ {{1}}.",
            words: ["–≤–∞—à —Å—ã–Ω", "–≤–∞—à–µ–≥–æ —Å—ã–Ω–∞", "–≤–∞—à–µ–≥–æ —Å—ã–Ω"],
            correctAnswers: { 1: "–≤–∞—à–µ–≥–æ —Å—ã–Ω–∞" }
        },
        {
            instruction: "Completa la frase scegliendo la forma corretta",
            text: "–¥–µ–≤—É—à–∫–∞ {{1}}.",
            words: ["–≤–∞—à –¥—Ä—É–≥–∞", "–≤–∞—à–µ–≥–æ –¥—Ä—É–≥—É", "–≤–∞—à–µ–≥–æ –¥—Ä—É–≥–∞"],
            correctAnswers: { 1: "–≤–∞—à–µ–≥–æ –¥—Ä—É–≥–∞" }
        },
        {
            instruction: "Completa la frase scegliendo la forma corretta",
            text: "–ñ–µ–Ω–∞ {{1}}.",
            words: ["—Ç–≤–æ–π –±—Ä–∞—Ç–∞", "—Ç–≤–æ–µ–≥–æ –±—Ä–∞—Ç", "—Ç–≤–æ–µ–≥–æ –±—Ä–∞—Ç–∞"],
            correctAnswers: { 1: "—Ç–≤–æ–µ–≥–æ –±—Ä–∞—Ç–∞" }
        }
    ];

    let currentExerciseIndex = 0;
    let checked = false;
    let gapElements = [];
    let wordElements = [];

    function loadExercise(index) {
        if (index >= exercises.length) {
            showCompletion();
            return;
        }

        checked = false;
        const exercise = exercises[index];

        exerciseContainer.innerHTML = `
            <div class="header">
                <div class="exercise-counter">Esercizio ${index + 1} di ${exercises.length}</div>
            </div>
            <div class="instruction">${exercise.instruction}</div>
            <div class="exercise-text" id="ex-accusativo-trascina-01-text">${exercise.text}</div>
            <div class="word-options" id="ex-accusativo-trascina-01-options"></div>
            <div class="controls">
                <button class="btn btn-primary" id="ex-accusativo-trascina-01-check">Verifica</button>
                <button class="btn btn-secondary" id="ex-accusativo-trascina-01-next" style="display:none;">Prossimo</button>
                <div class="feedback" id="ex-accusativo-trascina-01-feedback"></div>
            </div>
        `;

        const exerciseText = exerciseContainer.querySelector('#ex-accusativo-trascina-01-text');
        const wordOptionsContainer = exerciseContainer.querySelector('#ex-accusativo-trascina-01-options');
        const checkBtn = exerciseContainer.querySelector('#ex-accusativo-trascina-01-check');
        const nextBtn = exerciseContainer.querySelector('#ex-accusativo-trascina-01-next');
        const feedback = exerciseContainer.querySelector('#ex-accusativo-trascina-01-feedback');

        const placeholderPattern = /\{\{(\d+)\}\}/g;
        let textContent = exercise.text;

        textContent = textContent.replace(placeholderPattern, (match, number) => {
            return `<span class="gap" data-gap="${number}"></span>`;
        });

        exerciseText.innerHTML = textContent;

        gapElements = Array.from(exerciseText.querySelectorAll('.gap'));
        wordElements = [];

        exercise.words.forEach((word, idx) => {
            const wordElement = document.createElement('div');
            wordElement.className = 'word-option';
            wordElement.textContent = word;
            wordElement.dataset.word = word;
            wordElement.dataset.index = idx;
            wordElement.addEventListener('click', () => handleWordClick(wordElement));
            wordOptionsContainer.appendChild(wordElement);
            wordElements.push(wordElement);
        });

        gapElements.forEach(gap => {
            gap.addEventListener('click', () => handleGapClick(gap));
        });

        checkBtn.addEventListener('click', () => checkAnswers(exercise, feedback, nextBtn, checkBtn));
        nextBtn.addEventListener('click', () => {
            currentExerciseIndex++;
            loadExercise(currentExerciseIndex);
        });
    }

    function handleWordClick(wordElement) {
        if (wordElement.classList.contains('used') || checked) return;

        const emptyGap = gapElements.find(gap => !gap.classList.contains('filled'));
        if (!emptyGap) return;

        const word = wordElement.dataset.word;
        emptyGap.textContent = word;
        emptyGap.classList.add('filled');
        emptyGap.dataset.wordIndex = wordElement.dataset.index;
        emptyGap.dataset.word = word;
        wordElement.classList.add('used');
    }

    function handleGapClick(gap) {
        if (checked) return;
        if (!gap.classList.contains('filled')) return;

        const wordIndex = gap.dataset.wordIndex;
        const wordElement = wordElements.find(w => w.dataset.index === wordIndex);

        gap.textContent = '';
        gap.classList.remove('filled');
        delete gap.dataset.wordIndex;
        delete gap.dataset.word;

        if (wordElement) {
            wordElement.classList.remove('used');
        }
    }

    function checkAnswers(exercise, feedback, nextBtn, checkBtn) {
        checked = true;
        let correct = 0;
        let total = Object.keys(exercise.correctAnswers).length;

        gapElements.forEach(gap => {
            const gapNum = parseInt(gap.dataset.gap);
            const userAnswer = gap.dataset.word;
            const correctAnswer = exercise.correctAnswers[gapNum];

            if (userAnswer === correctAnswer) {
                gap.classList.remove('filled');
                gap.classList.add('correct');
                correct++;
            } else {
                gap.classList.add('incorrect');
            }
        });

        feedback.textContent = `Corretto: ${correct} / ${total}`;
        checkBtn.style.display = 'none';
        nextBtn.style.display = 'inline-block';
    }

    function showCompletion() {
        exerciseContainer.style.display = 'none';
        completionScreen.style.display = 'block';

        completionScreen.innerHTML = `
            <div class="completion">
                <h2>Complimenti!</h2>
                <p>Hai completato tutti i ${exercises.length} esercizi.</p>
            </div>
        `;
    }

    loadExercise(currentExerciseIndex);
})();
            </script>
        </div>

        <!-- Panel 5 (student) -->
        <article class="exercise-card" data-status="open" data-target="panel-acc-open-5">
            <span class="exercise-type">Drag &amp; Drop</span>
            <h3 class="exercise-title"> –ü–û–î–†–£–ì–ê –ú–û–ï–ô –î–ï–í–£–®–ö–ò </h3>
        </article>

        <div class="exercise-panel" id="panel-acc-open-5" data-access="student" hidden>
            <div id="ex-dragdrop-acc-05" class="universal-dd">
                <div id="ex-dragdrop-acc-05-container"></div>
                <div id="ex-dragdrop-acc-05-completion" style="display:none;"></div>
            </div>
            <script type="text/plain" data-lazy-script="panel-acc-open-5">
(() => {
    const rootID = 'ex-dragdrop-acc-05';
    const root = document.getElementById(rootID);
    const exerciseContainer = root && root.querySelector(`#${rootID}-container`);
    const completionScreen = root && root.querySelector(`#${rootID}-completion`);
    const exercises = [
        {
            instruction: "Completa la frase scegliendo la forma corretta",
            text: "–°–æ—Å–µ–¥–∫–∞ {{1}}.", 
            words: ["–º–æ—é –ø–æ–¥—Ä—É–≥—É", "–º–æ–µ–π –ø–æ–¥—Ä—É–≥–∞", "–º–æ—é –ø–æ–¥—Ä—É–≥–∏", "–º–æ–µ–π –ø–æ–¥—Ä—É–≥–∏"],  
            correctAnswers: { 1: "–º–æ–µ–π –ø–æ–¥—Ä—É–≥–∏" }
        },
        {
            instruction: "Completa la frase scegliendo la forma corretta", 
            text: "–ë—Ä–∞—Ç{{1}}.",
            words: ["–º–æ—è –¥–µ–≤—É—à–∫–∏", "–º–æ—é –¥–µ–≤—É—à–∫—É", "–º–æ–µ–π –¥–µ–≤—É—à–∫–∏", "–º–æ–µ–π –¥–µ–≤—É—à–∫—É"],   
            correctAnswers: { 1: "–º–æ–µ–π –¥–µ–≤—É—à–∫–∏" }  
        },
        {
            instruction: "Completa la frase scegliendo la forma corretta", 
            text: "–†–æ–¥–∏—Ç–µ–ª–∏ {{1}}.",  
            words: ["–º–æ—é –∂–µ–Ω–∞", "–º–æ—é –∂–µ–Ω—É", "–º–æ–µ–π –∂–µ–Ω–∞", "–º–æ–µ–π –∂–µ–Ω—ã"],  
            correctAnswers: { 1: "–º–æ–µ–π –∂–µ–Ω—ã" }  
        },
        {
            instruction: "Completa la frase scegliendo la forma corretta", 
            text: "–ö–æ—Ç {{1}}", 
            words: ["–Ω–∞—à—É –±–∞–±—É—à–∫—É", "–Ω–∞—à–µ–π –±–∞–±—É—à–∫–∞", "–Ω–∞—à—É –±–∞–±—É—à–∫–∏", "–Ω–∞—à–µ–π –±–∞–±—É—à–∫–∏"], 
            correctAnswers: { 1: "–Ω–∞—à–µ–π –±–∞–±—É—à–∫–∏" } 
        },
        {
            instruction: "Completa la frase scegliendo la forma corretta", 
            text: "–ë—Ä–∞—Ç {{1}}.",
            words: ["–ê–ª–µ–∫—Å–∞–Ω–¥—Ä—É", "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞", "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä—ã"], 
            correctAnswers: { 1: "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä—ã" }
        },
        {
            instruction: "Completa la frase scegliendo la forma corretta",
            text: "–ö–æ—Ç {{1}}.",
            words: ["–∏—Ö —Å–æ—Å–µ–¥–∫—É", "–∏—Ö —Å–æ—Å–µ–¥–∫–∏", "–º—Ö —Å–æ—Å–µ–¥–∫–∞"],   
            correctAnswers: { 1: "–∏—Ö —Å–æ—Å–µ–¥–∫–∏" } 
        },
        {
            instruction: "Completa la frase scegliendo la forma corretta", 
            text: "–ü–∞—Ä–µ–Ω—å {{1}}.", 
            words: ["–≤–∞—à–µ–≥–æ –ø–ª–µ–º—è–Ω–Ω–∏—Ü–∞", "–≤–∞—à—É –ø–ª–µ–º—è–Ω–Ω–∏—Ü—É", "–≤–∞—à–µ–π –ø–ª–µ–º—è–Ω–Ω–∏—Ü—ã"], 
            correctAnswers: { 1: "–≤–∞—à–µ–π –ø–ª–µ–º—è–Ω–Ω–∏—Ü—ã" }  
        },
        {
            instruction: "Completa la frase scegliendo la forma corretta", 
            text: "–°–æ–±–∞–∫–∞ {{1}}.", 
            words: ["–µ–≥–æ –¥–µ–≤—É—à–∫—É", "–µ–≥–æ –¥–µ–≤—É—à–∫–∏", "–µ–≥–æ –¥–µ–≤—É—à–∫–∞"], 
            correctAnswers: { 1: "–µ–≥–æ –¥–µ–≤—É—à–∫–∏" } 
        },
        {
            instruction: "Completa la frase scegliendo la forma corretta", 
            text: "–ú–∏—Å–∫–∞ {{1}}", 
            words: ["–Ω–∞—à–µ–≥–æ –∫–æ—à–∫—É", "–Ω–∞—à—É –∫–æ—à–∫—É", "–Ω–∞—à–µ–π –∫–æ—à–∫–∏"],
            correctAnswers: { 1: "–Ω–∞—à–µ–π –∫–æ—à–∫–∏" }
        }
    ];

    let currentExerciseIndex = 0;
    let checked = false;
    let gapElements = [];
    let wordElements = [];

    function loadExercise(index) {
        if (index >= exercises.length) {
            showCompletion();
            return;
        }

        checked = false;
        const exercise = exercises[index];

        exerciseContainer.innerHTML = `
            <div class="header">
                <div class="exercise-counter">Esercizio ${index + 1} di ${exercises.length}</div>
            </div>
            <div class="instruction">${exercise.instruction}</div>
            <div class="exercise-text" id="${rootID}-text">${exercise.text}</div>
            <div class="word-options" id="${rootID}-options"></div>
            <div class="controls">
                <div class="feedback" id="${rootID}-feedback"></div>
                <div>
                    <button class="btn btn-primary" id="${rootID}-check">Verifica</button>
                    <button class="btn btn-secondary" id="${rootID}-next" style="display:none;">Prossimo</button>
                </div>
            </div>
        `;

        const exerciseText = exerciseContainer.querySelector(`#${rootID}-text`);
        const wordOptionsContainer = exerciseContainer.querySelector(`#${rootID}-options`);
        const checkBtn = exerciseContainer.querySelector(`#${rootID}-check`);
        const nextBtn = exerciseContainer.querySelector(`#${rootID}-next`);
        const feedback = exerciseContainer.querySelector(`#${rootID}-feedback`);

        const placeholderPattern = /\{\{(\d+)\}\}/g;
        let textContent = exercise.text;

        textContent = textContent.replace(placeholderPattern, (_, number) =>
            `<span class="gap" data-gap="${number}"></span>`
        );

        exerciseText.innerHTML = textContent;

        gapElements = Array.from(exerciseText.querySelectorAll('.gap'));
        wordElements = [];

        exercise.words.forEach((word, idx) => {
            const el = document.createElement('div');
            el.className = 'word-option';
            el.textContent = word;
            el.dataset.word = word;
            el.dataset.index = idx;
            el.addEventListener('click', () => handleWordClick(el));
            wordOptionsContainer.appendChild(el);
            wordElements.push(el);
        });

        gapElements.forEach(gap => {
            gap.addEventListener('click', () => handleGapClick(gap));
        });

        checkBtn.addEventListener('click', () =>
            checkAnswers(exercise, feedback, nextBtn, checkBtn)
        );

        nextBtn.addEventListener('click', () => {
            currentExerciseIndex++;
            loadExercise(currentExerciseIndex);
        });
    }

    function handleWordClick(wordElement) {
        if (wordElement.classList.contains('used') || checked) return;

        const emptyGap = gapElements.find(g => !g.classList.contains('filled'));
        if (!emptyGap) return;

        emptyGap.textContent = wordElement.dataset.word;
        emptyGap.classList.add('filled');
        emptyGap.dataset.wordIndex = wordElement.dataset.index;
        emptyGap.dataset.word = wordElement.dataset.word;
        wordElement.classList.add('used');
    }

    function handleGapClick(gap) {
        if (checked || !gap.classList.contains('filled')) return;

        const wordIndex = gap.dataset.wordIndex;
        const wordElement = wordElements.find(w => w.dataset.index === wordIndex);

        gap.textContent = '';
        gap.classList.remove('filled');
        delete gap.dataset.wordIndex;
        delete gap.dataset.word;

        if (wordElement) wordElement.classList.remove('used');
    }

    function checkAnswers(exercise, feedback, nextBtn, checkBtn) {
        checked = true;
        let correct = 0;
        const total = Object.keys(exercise.correctAnswers).length;

        gapElements.forEach(gap => {
            const n = parseInt(gap.dataset.gap, 10);
            const user = gap.dataset.word;
            const right = exercise.correctAnswers[n];

            if (user === right) {
                gap.classList.add('correct');
                correct++;
            } else {
                gap.classList.add('incorrect');
            }
        });

        feedback.textContent = `Risultato: ${correct}/${total}`;
        feedback.style.color = correct === total ? '#15803d' : '#b91c1c';

        checkBtn.style.display = 'none';
        nextBtn.style.display = 'inline-block';
    }

    function showCompletion() {
        exerciseContainer.style.display = 'none';
        completionScreen.style.display = 'block';

        completionScreen.innerHTML = `
    <h2 style="color:#3b82f6;margin-bottom:20px;">Complimenti!</h2>
    <p style="font-size:1.2rem;color:#4b5563;">
        Hai completato tutti i ${exercises.length} esercizi.
    </p>
    <button class="btn btn-primary" onclick="location.reload()">
        Ricomincia
    </button>
`;
    }

    loadExercise(currentExerciseIndex);
})();
</script>
</div> 
        <!-- Panel 6 (paid) -->
        <article class="exercise-card" data-status="open" data-target="panel-acc-open-6">
            <span class="exercise-type">Drag &amp; Drop</span>
            <h3 class="exercise-title">–°–ï–ú–¨–Ø –ê–õ–¨–ë–ï–†–¢–ê</h3>
        </article>

        <div class="exercise-panel" id="panel-acc-open-6" data-access="paid" hidden>
            <div id="ex-dragdrop-acc-06" class="universal-dd">
                <div id="ex-dragdrop-acc-06-container"></div>
                <div id="ex-dragdrop-acc-06-completion" style="display:none;"></div>
            </div>
            <script type="text/plain" data-lazy-script="panel-acc-open-6">
(() => {
    const rootID = 'ex-dragdrop-acc-06';
    const root = document.getElementById(rootID);
    const exerciseContainer = root && root.querySelector(`#${rootID}-container`);
    const completionScreen = root && root.querySelector(`#${rootID}-completion`);
    const exercises = [
     {
            instruction: "Completa la frase scegliendo due forme corrette",
            text: "(—Å–µ—Å—Ç—Ä–∞) {{1}}  {{2}}(–ê–ª—å–±–µ—Ä—Ç) –∑–æ–≤—É—Ç –õ–∏–Ω–¥–∞.", 
            words: ["–°–µ—Å—Ç—Ä—É", "–°–µ—Å—Ç—Ä—ã", "–ê–ª—å–±–µ—Ä—Ç—É", "–ê–ª—å–±–µ—Ä—Ç–∞"], 
            correctAnswers: { 1: "–°–µ—Å—Ç—Ä—É", 2: "–ê–ª—å–±–µ—Ä—Ç–∞" } 
        },
         {
            instruction: "Completa la frase scegliendo due forme corrette", 
            text: "(–±—Ä–∞—Ç) {{1}} (–õ–∏–Ω–¥–∞) {{2}} –∑–æ–≤—É—Ç –ê–ª—å–±–µ—Ä—Ç.", 
            words: ["–ë—Ä–∞—Ç—É", "–ë—Ä–∞—Ç–∞", "–õ–∏–Ω–¥—É", "–õ–∏–Ω–¥—ã"], 
            correctAnswers: { 1: "–ë—Ä–∞—Ç–∞", 2: "–õ–∏–Ω–¥—ã" } 
        },
         {
            instruction: "Completa la frase scegliendo due forme corrette",
            text: "(–∂–µ–Ω–∞) {{1}} (–í–ª–∞–¥–∏—Å–ª–∞–≤) {{2}} –∑–æ–≤—É—Ç –õ–∏–Ω–¥–∞.", 
            words: ["–ñ–µ–Ω—É", "–ñ–µ–Ω—ã", "–í–ª–∞–¥–∏—Å–ª–∞–≤", "–í–ª–∞–¥–∏—Å–ª–∞–≤–∞"], 
            correctAnswers: { 1: "–ñ–µ–Ω—É", 2: "–í–ª–∞–¥–∏—Å–ª–∞–≤–∞" } 
        },
         {
            instruction: "Completa la frase scegliendo due forme corrette", 
            text: "(–ú—É–∂){{1}} (–õ–∏–Ω–¥–∞) {{2}} –∑–æ–≤—É—Ç –í–ª–∞–¥–∏—Å–ª–∞–≤.", 
            words: ["–ú—É–∂—É", "–ú—É–∂–∞", "–õ–∏–Ω–¥—ã", "–õ–∏–Ω–¥—É"], 
            correctAnswers: { 1: "–ú—É–∂–∞", 2: "–õ–∏–Ω–¥—ã" } 
        },
         {
            instruction: "Completa la frase scegliendo due forme corrette", 
            text: "(–ë—Ä–∞—Ç){{1}} (–ï–ª–µ–Ω–∞) {{2}} –∑–æ–≤—É—Ç –í–ª–∞–¥–∏—Å–ª–∞–≤.", 
            words: ["–ë—Ä–∞—Ç", "–ë—Ä–∞—Ç–∞", "–ï–ª–µ–Ω—É", "–ï–ª–µ–Ω—ã"], 
            correctAnswers: { 1: "–ë—Ä–∞—Ç–∞", 2: "–ï–ª–µ–Ω—ã" } 
        },
         {
            instruction: "Completa la frase scegliendo due forme corrette", 
            text: "(–°–µ—Å—Ç—Ä–∞){{1}} (–í–ª–∞–¥–∏—Å–ª–∞–≤) {{2}} –∑–æ–≤—É—Ç –ï–ª–µ–Ω–∞.", 
            words: ["–°–µ—Å—Ç—Ä—ã", "–°–µ—Å—Ç—Ä—É", "–í–ª–∞–¥–∏—Å–ª–∞–≤—É", "–í–ª–∞–¥–∏—Å–ª–∞–≤–∞"], 
            correctAnswers: { 1: "–°–µ—Å—Ç—Ä—É", 2: "–í–ª–∞–¥–∏—Å–ª–∞–≤–∞" } 
        },
         {
            instruction: "Completa la frase scegliendo due forme corrette", 
            text: " (–¢—ë—Ç—è) {{1}} (–ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞) {{2}} –∑–æ–≤—É—Ç –ï–ª–µ–Ω–∞.", 
            words: ["–¢—ë—Ç–∏", "–¢—ë—Ç—é", "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä—É", "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä—ã"], 
            correctAnswers: { 1: "–¢—ë—Ç—é", 2: "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä—ã" } 
        },
        {
            instruction: "Completa la farse scegliendo due forme corrette",
            text: "(–ü–ª–µ–º—è–Ω–Ω–∏—Ü–∞) {{1}} (–ï–ª–µ–Ω–∞) {{2}} –∑–æ–≤—É—Ç –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞.",
            words:["–ü–ª–µ–º—è–Ω–Ω–∏—Ü—É", "–ü–ª–µ–º—è–Ω–Ω–∏—Ü—ã", "–ï–ª–µ–Ω—ã", "–ï–ª–µ–Ω—É"],
            correctAnswers: { 1: "–ü–ª–µ–º—è–Ω–Ω–∏—Ü—É", 2: "–ï–ª–µ–Ω—ã"}
        },
        {
            instruction: "Completa la farse scegliendo due forme corrette",
            text: "(–î–æ—á—å) {{1}} (–í–ª–∞–¥–∏—Å–ª–∞–≤) {{2}} –∑–æ–≤—É—Ç –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞.",
            words:["–î–æ—á—É", "–î–æ—á—å", "–í–ª–∞–¥–∏—Å–ª–∞–≤–∞", "–í–ª–∞–¥–∏—Å–ª–∞–≤—ã"],
            correctAnswers: { 1: "–î–æ—á—å", 2: "–í–ª–∞–¥–∏—Å–ª–∞–≤–∞"}
        },
        {
            instruction: "Completa la farse scegliendo due forme corrette",
            text: "(–û—Ç–µ—Ü) {{1}} (–ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞) {{2}} –∑–æ–≤—É—Ç –í–ª–∞–¥–∏—Å–ª–∞–≤.",
            words:["–û—Ç–µ—Ü–∞", "–û—Ç—Ü–∞", "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä—É—É", "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä—ã"],
            correctAnswers: { 1: "–û—Ç—Ü–∞", 2: "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä—ã"}
        },
        {
            instruction: "Completa la farse scegliendo due forme corrette",
            text: "(–°—ã–Ω) {{1}} (–õ–∏–Ω–¥–∞) {{2}} –∑–æ–≤—É—Ç –ê–Ω–∞—Ç–æ–ª–∏–π.",
            words:["–°—ã–Ω–∞", "–°—ã–Ω—É", "–õ–∏–Ω–¥—É", "–õ–∏–Ω–¥—ã"],
            correctAnswers: { 1: "–°—ã–Ω–∞", 2: "–õ–∏–Ω–¥—ã"}
        },
        {
            instruction: "Completa la farse scegliendo due forme corrette",
            text: "(–î–æ—á—å) {{1}} (–í–ª–∞–¥–∏—Å–ª–∞–≤) {{2}} –∑–æ–≤—É—Ç –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞.",
            words:["–î–æ—á—å", "–î–æ—á–∏", "–í–ª–∞–¥–∏—Å–ª–∞–≤—ã", "–í–ª–∞–¥–∏—Å–ª–∞–≤–∞"],
            correctAnswers: { 1: "–î–æ—á—å", 2: "–í–ª–∞–¥–∏—Å–ª–∞–≤–∞"}
        },
        {
            instruction: "Completa la farse scegliendo due forme corrette",
            text: "(–ø–ª–µ–º—è–Ω–Ω–∏–∫) {{1}} (–ê–ª—å–±–µ—Ä—Ç) {{2}} –∑–æ–≤—É—Ç –ê–Ω–∞—Ç–æ–ª–∏–π.",
            words:["–ü–ª–µ–º—è–Ω–Ω–∏–∫–∞", "–ü–ª–µ–º—è–Ω–Ω–∏–∫–∏", "–ê–ª—å–±–µ—Ä—Ç—É", "–ê–ª—å–±–µ—Ä—Ç–∞"],
            correctAnswers: { 1: "–ü–ª–µ–º—è–Ω–Ω–∏–∫–∞", 2: "–ê–ª—å–±–µ—Ä—Ç–∞"}
        },
        ];

    let currentExerciseIndex = 0;
    let checked = false;
    let gapElements = [];
    let wordElements = [];

    function loadExercise(index) {
        if (index >= exercises.length) {
            showCompletion();
            return;
        }

        checked = false;
        const exercise = exercises[index];

        exerciseContainer.innerHTML = `
            <div class="header">
                <div class="exercise-counter">Esercizio ${index + 1} di ${exercises.length}</div>
            </div>
            <div class="instruction">${exercise.instruction}</div>
            <div class="exercise-text" id="${rootID}-text">${exercise.text}</div>
            <div class="word-options" id="${rootID}-options"></div>
            <div class="controls">
                <div class="feedback" id="${rootID}-feedback"></div>
                <div>
                    <button class="btn btn-primary" id="${rootID}-check">Verifica</button>
                    <button class="btn btn-secondary" id="${rootID}-next" style="display:none;">Prossimo</button>
                </div>
            </div>
        `;

        const exerciseText = exerciseContainer.querySelector(`#${rootID}-text`);
        const wordOptionsContainer = exerciseContainer.querySelector(`#${rootID}-options`);
        const checkBtn = exerciseContainer.querySelector(`#${rootID}-check`);
        const nextBtn = exerciseContainer.querySelector(`#${rootID}-next`);
        const feedback = exerciseContainer.querySelector(`#${rootID}-feedback`);

        const placeholderPattern = /\{\{(\d+)\}\}/g;
        let textContent = exercise.text;

        textContent = textContent.replace(placeholderPattern, (_, number) =>
            `<span class="gap" data-gap="${number}"></span>`
        );

        exerciseText.innerHTML = textContent;

        gapElements = Array.from(exerciseText.querySelectorAll('.gap'));
        wordElements = [];

        exercise.words.forEach((word, idx) => {
            const el = document.createElement('div');
            el.className = 'word-option';
            el.textContent = word;
            el.dataset.word = word;
            el.dataset.index = idx;
            el.addEventListener('click', () => handleWordClick(el));
            wordOptionsContainer.appendChild(el);
            wordElements.push(el);
        });

        gapElements.forEach(gap => {
            gap.addEventListener('click', () => handleGapClick(gap));
        });

        checkBtn.addEventListener('click', () =>
            checkAnswers(exercise, feedback, nextBtn, checkBtn)
        );

        nextBtn.addEventListener('click', () => {
            currentExerciseIndex++;
            loadExercise(currentExerciseIndex);
        });
    }

    function handleWordClick(wordElement) {
        if (wordElement.classList.contains('used') || checked) return;

        const emptyGap = gapElements.find(g => !g.classList.contains('filled'));
        if (!emptyGap) return;

        emptyGap.textContent = wordElement.dataset.word;
        emptyGap.classList.add('filled');
        emptyGap.dataset.wordIndex = wordElement.dataset.index;
        emptyGap.dataset.word = wordElement.dataset.word;
        wordElement.classList.add('used');
    }

    function handleGapClick(gap) {
        if (checked || !gap.classList.contains('filled')) return;

        const wordIndex = gap.dataset.wordIndex;
        const wordElement = wordElements.find(w => w.dataset.index === wordIndex);

        gap.textContent = '';
        gap.classList.remove('filled');
        delete gap.dataset.wordIndex;
        delete gap.dataset.word;

        if (wordElement) wordElement.classList.remove('used');
    }

    function checkAnswers(exercise, feedback, nextBtn, checkBtn) {
        checked = true;
        let correct = 0;
        const total = Object.keys(exercise.correctAnswers).length;

        gapElements.forEach(gap => {
            const n = parseInt(gap.dataset.gap, 10);
            const user = gap.dataset.word;
            const right = exercise.correctAnswers[n];

            if (user === right) {
                gap.classList.add('correct');
                correct++;
            } else {
                gap.classList.add('incorrect');
            }
        });

        feedback.textContent = `Risultato: ${correct}/${total}`;
        feedback.style.color = correct === total ? '#15803d' : '#b91c1c';

        checkBtn.style.display = 'none';
        nextBtn.style.display = 'inline-block';
    }

    function showCompletion() {
        exerciseContainer.style.display = 'none';
        completionScreen.style.display = 'block';

        completionScreen.innerHTML = `
    <h2 style="color:#3b82f6;margin-bottom:20px;">Complimenti!</h2>
    <p style="font-size:1.2rem;color:#4b5563;">
        Hai completato tutti i ${exercises.length} esercizi.
    </p>
    <button class="btn btn-primary" onclick="location.reload()">
        Ricomincia
    </button>
`;
    }

    loadExercise(currentExerciseIndex);
})();
            </script>
        </div>

        <!-- Panel 2 (public) -->
        <article class="exercise-card" data-status="open" data-target="panel-acc-open-2">
            <span class="exercise-type">Flashcards</span>
            <h3 class="exercise-title"> –ë–†–ê–¢ –ú–û–ï–ô –ü–û–î–†–£–ì–ò ‚Ä¶</h3>
            <span class="card-subtitle">Nomi ¬∑ 1¬™ declinazione</span>
        </article>

        <div class="exercise-panel" id="panel-acc-open-2" data-access="public" hidden>
            <section id="ex-flashcards-acc-03">
                <div class="fca01-header">
                    <h2>il genitivo di appartenenza</h2>
                    <p>Scegliere modalit√†</p>
                </div>

                <div class="fca01-mode-buttons">
                    <button class="fca01-mode-btn active" data-mode="study">ESPLORARE</button>
                    <button class="fca01-mode-btn" data-mode="quiz">QUIZ</button>
                    <button class="fca01-mode-btn" data-mode="match">MATCH</button>
                </div>

                <div id="ex-flashcards-acc-03-section-study" class="fca01-section visible">
                    <div id="ex-flashcards-acc-03-learning-area-study"></div>
                    <div class="fca01-nav">
                        <button id="ex-flashcards-acc-03-prev-btn" class="fca01-btn-nav">‚Üê –ù–∞–∑–∞–¥</button>
                        <span id="ex-flashcards-acc-03-counter" class="fca01-counter">1 / 7</span>
                        <button id="ex-flashcards-acc-03-next-btn" class="btn btn-primary">–í–ø–µ—Ä–µ–¥ ‚Üí</button>
                    </div>
                </div>

                <div id="ex-flashcards-acc-03-section-quiz" class="fca01-section">
                    <div id="ex-flashcards-acc-03-learning-area-quiz"></div>
                    <div class="fca01-center-btn">
                        <button id="ex-flashcards-acc-03-start-quiz-btn" class="btn btn-primary hidden">–ù–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å</button>
                    </div>
                </div>

                <div id="ex-flashcards-acc-03-section-match" class="fca01-section">
                    <div id="ex-flashcards-acc-03-learning-area-match"></div>
                    <div class="fca01-center-btn">
                        <button id="ex-flashcards-acc-03-reset-match-btn" class="btn btn-secondary">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
                    </div>
                </div>
            </section>

            <script type="text/plain" data-lazy-script="panel-acc-open-2">
(() => {
    const rootEl = document.getElementById('ex-flashcards-acc-03');
    if (!rootEl) {
        console.warn('‚ö†Ô∏è Flashcards: Container #ex-flashcards-acc-03 NOT FOUND');
        return;
    }

    function initFlashcardsAcc02(root) {
        const flashcardsData = [
            { front: "–î—Ä—É–≥ (–º–æ—è —Ç—ë—Ç—è).", back: "–î—Ä—É–≥ –º–æ–µ–π —Ç—ë—Ç–∏." },
            { front: "–ú–∞—à–∏–Ω–∞ (–º–æ—è –¥–µ–≤—É—à–∫–∞).", back: "–ú–∞—à–∏–Ω–∞ –º–æ–µ–π –¥–µ–≤—É—à–∫–∏." },
            { front: "–î–æ–º (–º–æ–π –¥—è–¥—è).", back: "–î–æ–º –º–æ–µ–≥–æ –¥—è–¥–∏." },
            { front: "–ü–æ–¥—É—à–∫–∞ (–Ω–∞—à–∞ –∫–æ—à–∫–∞).", back: "–ü–æ–¥—É—à–∫–∞ –Ω–∞—à–µ–π –∫–æ—à–∫–∏." },
            { front: "–°–æ–±–∞–∫–∞ (–≤–∞—à–∞ —Å–æ—Å–µ–¥–∫–∞).", back: "–°–æ–±–∞–∫–∞ –≤–∞—à–µ–π —Å–æ—Å–µ–¥–∫–∏." },
            { front: "–¢–µ–ª–µ—Ñ–æ–Ω (—Ç–≤–æ—è –ø–æ–¥—Ä—É–≥–∞).", back: "–¢–µ–ª–µ—Ñ–æ–Ω —Ç–≤–æ–µ–π –ø–æ–¥—Ä—É–≥–∏." },
            { front: "–ö–æ—Ç (–∏—Ö –±–∞–±—É—à–∫–∞)", back: "–ö–æ—Ç –∏—Ö –±–∞–±—É—à–∫–∏." },
            { front: "–ú–æ—Ç–æ (–Ω–∞—à –¥–µ–¥—É—à–∫–∞).", back: "–ú–æ—Ç–æ –Ω–∞—à–µ–≥–æ –¥–µ–¥—É—à–∫–∞." }
        ];

        let currentMode = 'study';
        let currentIndex = 0;
        let selectedMatchCard = null;
        let isProcessingMatch = false;
        let cachedRuVoice = null;

        function pickRuVoice() {
            const voices = window.speechSynthesis.getVoices();
            const ruVoice = voices.find(v => v.lang.includes('ru'));
            if (ruVoice) cachedRuVoice = ruVoice;
        }

        function textToSpeech(text, lang = 'ru-RU') {
            if (!('speechSynthesis' in window)) return;
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = lang;
            utterance.rate = 0.9;
            utterance.pitch = 1;
            utterance.volume = 1;
            if (cachedRuVoice) utterance.voice = cachedRuVoice;
            window.speechSynthesis.speak(utterance);
        }

        function playAudio(text, event) {
            event.stopPropagation();
            textToSpeech(text);
        }

        function switchMode(mode) {
            currentMode = mode;
            root.querySelectorAll('.fca01-mode-btn').forEach(btn => btn.classList.remove('active'));
            root.querySelectorAll('.fca01-section').forEach(sec => sec.classList.remove('visible'));
            root.querySelector(`#ex-flashcards-acc-03-section-${mode}`).classList.add('visible');
            root.querySelector(`[data-mode="${mode}"]`).classList.add('active');

            if (mode === 'study') { currentIndex = 0; renderCard(); }
            else if (mode === 'quiz') { renderQuiz(); root.querySelector('#ex-flashcards-acc-03-start-quiz-btn').classList.add('hidden'); }
            else if (mode === 'match') { initMatchGame(); }
        }

        function renderCard() {
            const area = root.querySelector('#ex-flashcards-acc-03-learning-area-study');
            const counter = root.querySelector('#ex-flashcards-acc-03-counter');
            const cardData = flashcardsData[currentIndex];

            counter.textContent = `${currentIndex + 1} / ${flashcardsData.length}`;
            area.innerHTML = `
                <div class="fca01-card-container">
                    <div class="fca01-card">
                        <div class="fca01-card-face fca01-card-front">
                            <button class="fca01-audio-btn" data-text="${cardData.front}">üîä</button>
                            ${cardData.front}
                        </div>
                        <div class="fca01-card-face fca01-card-back">
                            <button class="fca01-audio-btn" data-text="${cardData.back}">üîä</button>
                            ${cardData.back}
                        </div>
                    </div>
                </div>
            `;

            const card = area.querySelector('.fca01-card');
            card.addEventListener('click', function() {
                this.classList.toggle('is-flipped');
            });

            area.querySelectorAll('.fca01-audio-btn').forEach(btn => {
                btn.addEventListener('click', (e) => playAudio(btn.dataset.text, e));
            });
        }

        function nextCard() {
            currentIndex = (currentIndex + 1) % flashcardsData.length;
            renderCard();
        }

        function prevCard() {
            currentIndex = currentIndex > 0 ? currentIndex - 1 : flashcardsData.length - 1;
            renderCard();
        }

        function renderQuiz() {
            const area = root.querySelector('#ex-flashcards-acc-03-learning-area-quiz');
            root.querySelector('#ex-flashcards-acc-03-start-quiz-btn').classList.add('hidden');

            const randomIndex = Math.floor(Math.random() * flashcardsData.length);
            const correctCard = flashcardsData[randomIndex];

            let options = [correctCard];
            while (options.length < 3 && options.length < flashcardsData.length) {
                const randomWrong = flashcardsData[Math.floor(Math.random() * flashcardsData.length)];
                if (!options.some(opt => opt.back === randomWrong.back)) options.push(randomWrong);
            }
            options.sort(() => Math.random() - 0.5);

            const buttonsHTML = options.map(opt =>
                `<button class="fca01-quiz-option" data-answer="${opt.back}" data-correct="${correctCard.back}">
                    ${opt.back}
                </button>`
            ).join('');

            area.innerHTML = `
                <div class="fca01-quiz-area">
                    <h3 class="fca01-quiz-question">–ù–∞–π–¥–∏ –≤—Ç–æ—Ä—É—é —á–∞—Å—Ç—å: <br><span class="highlight">"${correctCard.front}"</span></h3>
                    <div class="fca01-quiz-options">${buttonsHTML}</div>
                    <p class="fca01-quiz-feedback"></p>
                </div>
            `;

            area.querySelectorAll('.fca01-quiz-option').forEach(btn => {
                btn.addEventListener('click', function() {
                    checkQuizAnswer(this.dataset.answer, this.dataset.correct, this);
                });
            });
        }

        function checkQuizAnswer(selected, correct, btnElement) {
            const feedback = root.querySelector('.fca01-quiz-feedback');
            const nextBtn = root.querySelector('#ex-flashcards-acc-03-start-quiz-btn');

            root.querySelectorAll('.fca01-quiz-option').forEach(btn => {
                btn.style.pointerEvents = 'none';
                if (btn.dataset.answer === correct) btn.classList.add('correct');
            });

            if (selected === correct) {
                feedback.textContent = "‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ!";
                feedback.className = "fca01-quiz-feedback correct";
            } else {
                btnElement.classList.add('wrong');
                feedback.textContent = "‚ùå –û—à–∏–±–∫–∞!";
                feedback.className = "fca01-quiz-feedback wrong";
            }
            nextBtn.classList.remove('hidden');
        }

        function initMatchGame() {
            const area = root.querySelector('#ex-flashcards-acc-03-learning-area-match');
            selectedMatchCard = null;
            isProcessingMatch = false;

            let fronts = flashcardsData.map((card, index) => ({ text: card.front, type: 'front', id: index }));
            let backs = flashcardsData.map((card, index) => ({ text: card.back, type: 'back', id: index }));

            fronts.sort(() => Math.random() - 0.5);
            backs.sort(() => Math.random() - 0.5);

            area.innerHTML = `
                <div class="fca01-match-container">
                    <p class="fca01-match-feedback"></p>
                    <div class="fca01-match-grid">
                        <div class="fca01-match-col" id="ex-flashcards-acc-03-match-col-fronts"></div>
                        <div class="fca01-match-col" id="ex-flashcards-acc-03-match-col-backs"></div>
                    </div>
                </div>
            `;

            const colFronts = root.querySelector('#ex-flashcards-acc-03-match-col-fronts');
            const colBacks = root.querySelector('#ex-flashcards-acc-03-match-col-backs');

            function createMatchElement(item) {
                const div = document.createElement('div');
                div.className = 'fca01-match-card';
                div.textContent = item.text;
                div.dataset.id = item.id;
                div.dataset.type = item.type;
                div.addEventListener('click', () => handleMatchClick(div));
                return div;
            }

            fronts.forEach(item => colFronts.appendChild(createMatchElement(item)));
            backs.forEach(item => colBacks.appendChild(createMatchElement(item)));
        }

        function handleMatchClick(clickedCard) {
            if (isProcessingMatch || clickedCard.classList.contains('matched')) return;
            if (clickedCard === selectedMatchCard) return;

            const feedbackEl = root.querySelector('.fca01-match-feedback');

            if (!selectedMatchCard) {
                selectedMatchCard = clickedCard;
                clickedCard.classList.add('selected');
                return;
            }

            if (selectedMatchCard.dataset.type === clickedCard.dataset.type) {
                selectedMatchCard.classList.remove('selected');
                selectedMatchCard = clickedCard;
                clickedCard.classList.add('selected');
                return;
            }

            const firstId = selectedMatchCard.dataset.id;
            const secondId = clickedCard.dataset.id;
            const previousCard = selectedMatchCard;

            if (firstId === secondId) {
                previousCard.classList.add('matched');
                clickedCard.classList.add('matched');
                feedbackEl.textContent = "‚ú® –û—Ç–ª–∏—á–Ω–æ!";
                feedbackEl.className = "fca01-match-feedback correct";
                selectedMatchCard = null;
                setTimeout(() => { feedbackEl.textContent = ""; }, 1000);

                const remaining = root.querySelectorAll('.fca01-match-card:not(.matched)').length;
                if (remaining === 0) feedbackEl.textContent = "üéâ –ü–û–ë–ï–î–ê! üéâ";
            } else {
                isProcessingMatch = true;
                clickedCard.classList.add('wrong');
                previousCard.classList.add('wrong');
                feedbackEl.textContent = "–ù–µ–≤–µ—Ä–Ω–æ";
                feedbackEl.className = "fca01-match-feedback wrong";

                setTimeout(() => {
                    clickedCard.classList.remove('selected', 'wrong');
                    previousCard.classList.remove('selected', 'wrong');
                    feedbackEl.textContent = "";
                    isProcessingMatch = false;
                }, 800);

                selectedMatchCard = null;
            }
        }

        pickRuVoice();
        if (!cachedRuVoice) {
            window.speechSynthesis.onvoiceschanged = () => {
                pickRuVoice();
                window.speechSynthesis.onvoiceschanged = null;
            };
        }

        root.querySelectorAll('.fca01-mode-btn').forEach(btn => {
            btn.addEventListener('click', () => switchMode(btn.dataset.mode));
        });

        root.querySelector('#ex-flashcards-acc-03-next-btn').addEventListener('click', nextCard);
        root.querySelector('#ex-flashcards-acc-03-prev-btn').addEventListener('click', prevCard);
        root.querySelector('#ex-flashcards-acc-03-start-quiz-btn').addEventListener('click', renderQuiz);
        root.querySelector('#ex-flashcards-acc-03-reset-match-btn').addEventListener('click', initMatchGame);

        switchMode('study');
    }

    initFlashcardsAcc02(rootEl);
})();
            </script>
        </div>

        <!-- Panel 7 (student) -->
        <article class="exercise-card" data-status="open" data-target="panel-acc-open-7">
            <span class="exercise-type">Flashcards</span>

            <h3 class="exercise-title">–î–ï–í–£–®–ö–ê –ú–û–ï–ì–û –î–†–£–ì–ê</h3>
            <span class="card-subtitle">Nomi ¬∑ 2¬∞ declinazione</span>


        </article>

        <div class="exercise-panel" id="panel-acc-open-7" data-access="student" hidden>
            <section id="ex-flashcards-acc-07">
                <div class="fca01-header">
                    <h2>Il genitivo di appartenenza</h2>
                    <p>Scegliere modalit√†</p>
                </div>

                <div class="fca01-mode-buttons">
                    <button class="fca01-mode-btn active" data-mode="study">ESPLORARE</button>
                    <button class="fca01-mode-btn" data-mode="quiz">QUIZ</button>
                    <button class="fca01-mode-btn" data-mode="match">MATCH</button>
                </div>

                <div id="ex-flashcards-acc-07-section-study" class="fca01-section visible">
                    <div id="ex-flashcards-acc-07-learning-area-study"></div>
                    <div class="fca01-nav">
                        <button id="ex-flashcards-acc-07-prev-btn" class="fca01-btn-nav">‚Üê –ù–∞–∑–∞–¥</button>
                        <span id="ex-flashcards-acc-07-counter" class="fca01-counter">1 / 7</span>
                        <button id="ex-flashcards-acc-07-next-btn" class="btn btn-primary">–í–ø–µ—Ä–µ–¥ ‚Üí</button>
                    </div>
                </div>

                <div id="ex-flashcards-acc-07-section-quiz" class="fca01-section">
                    <div id="ex-flashcards-acc-07-learning-area-quiz"></div>
                    <div class="fca01-center-btn">
                        <button id="ex-flashcards-acc-07-start-quiz-btn" class="btn btn-primary hidden">–ù–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å</button>
                    </div>
                </div>

                <div id="ex-flashcards-acc-07-section-match" class="fca01-section">
                    <div id="ex-flashcards-acc-07-learning-area-match"></div>
                    <div class="fca01-center-btn">
                        <button id="ex-flashcards-acc-07-reset-match-btn" class="btn btn-secondary">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
                    </div>
                </div>
            </section>

            <script type="text/plain" data-lazy-script="panel-acc-open-7">
(() => {
    const rootEl = document.getElementById('ex-flashcards-acc-07');
    if (!rootEl) {
        console.warn('‚ö†Ô∏è Flashcards: Container #ex-flashcards-acc-07 NOT FOUND');
        return;
    }

    function initFlashcardsAcc07(root) {
        const flashcardsData = [
            { front: "–°–µ—Å—Ç—Ä–∞ (–Ω–∞—à –¥—Ä—É–≥).", back: "–°–µ—Å—Ç—Ä–∞ –Ω–∞—à–µ–≥–æ –¥—Ä—É–≥–∞." },
            { front: "–î–µ–≤—É—à–∫–∞ (–≤–∞—à —Å—ã–Ω).", back: "–î–µ–≤—É—à–∫–∞ –≤–∞—à–µ–≥–æ —Å—ã–Ω–∞." },
            { front: "–°–æ—Å–µ–¥ (–º–æ–π –ø–ª–µ–º—è–Ω–Ω–∏–∫).", back: "–°–æ—Å–µ–¥ –º–æ–µ–≥–æ –ø–ª–µ–º—è–Ω–Ω–∏–∫–∞." },
            { front: "–ö–æ—Ç (–∏—Ö —Å–æ—Å–µ–¥).", back: "–ö–æ—Ç –∏—Ö —Å–æ—Å–µ–¥–∞." },
            { front: "–ú–∞—à–∏–Ω–∞ (—Ç–≤–æ–π –±—Ä–∞—Ç).", back: "–ú–∞—à–∏–Ω–∞ —Ç–≤–æ–µ–≥–æ –±—Ä–∞—Ç–∞." },
            { front: "–¢–µ–ª–µ—Ñ–æ–Ω (–µ—ë –º—É–∂).", back: "–¢–µ–ª–µ—Ñ–æ–Ω –µ—ë –º—É–∂–∞" },
            { front: "–ë—Ä–∞—Ç (–µ—ë –ø–∞—Ä–µ–Ω—å).", back: "–ë—Ä–∞—Ç –µ—ë –ø–∞—Ä–Ω—è" },
            { front: "–î–æ–º (–Ω–∞—à –æ—Ç–µ—Ü).", back: "–î–æ–º –Ω–∞—à–µ–≥–æ –æ—Ç—Ü–∞." }
        ];

        let currentMode = 'study';
        let currentIndex = 0;
        let selectedMatchCard = null;
        let isProcessingMatch = false;
        let cachedRuVoice = null;

        function pickRuVoice() {
            const voices = window.speechSynthesis.getVoices();
            const ruVoice = voices.find(v => v.lang.includes('ru'));
            if (ruVoice) cachedRuVoice = ruVoice;
        }

        function textToSpeech(text, lang = 'ru-RU') {
            if (!('speechSynthesis' in window)) return;
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = lang;
            utterance.rate = 0.9;
            utterance.pitch = 1;
            utterance.volume = 1;
            if (cachedRuVoice) utterance.voice = cachedRuVoice;
            window.speechSynthesis.speak(utterance);
        }

        function playAudio(text, event) {
            event.stopPropagation();
            textToSpeech(text);
        }

        function switchMode(mode) {
            currentMode = mode;
            root.querySelectorAll('.fca01-mode-btn').forEach(btn => btn.classList.remove('active'));
            root.querySelectorAll('.fca01-section').forEach(sec => sec.classList.remove('visible'));
            root.querySelector(`#ex-flashcards-acc-07-section-${mode}`).classList.add('visible');
            root.querySelector(`[data-mode="${mode}"]`).classList.add('active');

            if (mode === 'study') { currentIndex = 0; renderCard(); }
            else if (mode === 'quiz') { renderQuiz(); root.querySelector('#ex-flashcards-acc-07-start-quiz-btn').classList.add('hidden'); }
            else if (mode === 'match') { initMatchGame(); }
        }

        function renderCard() {
            const area = root.querySelector('#ex-flashcards-acc-07-learning-area-study');
            const counter = root.querySelector('#ex-flashcards-acc-07-counter');
            const cardData = flashcardsData[currentIndex];

            counter.textContent = `${currentIndex + 1} / ${flashcardsData.length}`;
            area.innerHTML = `
                <div class="fca01-card-container">
                    <div class="fca01-card">
                        <div class="fca01-card-face fca01-card-front">
                            <button class="fca01-audio-btn" data-text="${cardData.front}">üîä</button>
                            ${cardData.front}
                        </div>
                        <div class="fca01-card-face fca01-card-back">
                            <button class="fca01-audio-btn" data-text="${cardData.back}">üîä</button>
                            ${cardData.back}
                        </div>
                    </div>
                </div>
            `;

            const card = area.querySelector('.fca01-card');
            card.addEventListener('click', function() {
                this.classList.toggle('is-flipped');
            });

            area.querySelectorAll('.fca01-audio-btn').forEach(btn => {
                btn.addEventListener('click', (e) => playAudio(btn.dataset.text, e));
            });
        }

        function nextCard() {
            currentIndex = (currentIndex + 1) % flashcardsData.length;
            renderCard();
        }

        function prevCard() {
            currentIndex = currentIndex > 0 ? currentIndex - 1 : flashcardsData.length - 1;
            renderCard();
        }

        function renderQuiz() {
            const area = root.querySelector('#ex-flashcards-acc-07-learning-area-quiz');
            root.querySelector('#ex-flashcards-acc-07-start-quiz-btn').classList.add('hidden');

            const randomIndex = Math.floor(Math.random() * flashcardsData.length);
            const correctCard = flashcardsData[randomIndex];

            let options = [correctCard];
            while (options.length < 3 && options.length < flashcardsData.length) {
                const randomWrong = flashcardsData[Math.floor(Math.random() * flashcardsData.length)];
                if (!options.some(opt => opt.back === randomWrong.back)) options.push(randomWrong);
            }
            options.sort(() => Math.random() - 0.5);

            const buttonsHTML = options.map(opt =>
                `<button class="fca01-quiz-option" data-answer="${opt.back}" data-correct="${correctCard.back}">
                    ${opt.back}
                </button>`
            ).join('');

            area.innerHTML = `
                <div class="fca01-quiz-area">
                    <h3 class="fca01-quiz-question">–ù–∞–π–¥–∏ –≤—Ç–æ—Ä—É—é —á–∞—Å—Ç—å: <br><span class="highlight">"${correctCard.front}"</span></h3>
                    <div class="fca01-quiz-options">${buttonsHTML}</div>
                    <p class="fca01-quiz-feedback"></p>
                </div>
            `;

            area.querySelectorAll('.fca01-quiz-option').forEach(btn => {
                btn.addEventListener('click', function() {
                    checkQuizAnswer(this.dataset.answer, this.dataset.correct, this);
                });
            });
        }

        function checkQuizAnswer(selected, correct, btnElement) {
            const feedback = root.querySelector('.fca01-quiz-feedback');
            const nextBtn = root.querySelector('#ex-flashcards-acc-07-start-quiz-btn');

            root.querySelectorAll('.fca01-quiz-option').forEach(btn => {
                btn.style.pointerEvents = 'none';
                if (btn.dataset.answer === correct) btn.classList.add('correct');
            });

            if (selected === correct) {
                feedback.textContent = "‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ!";
                feedback.className = "fca01-quiz-feedback correct";
            } else {
                btnElement.classList.add('wrong');
                feedback.textContent = "‚ùå –û—à–∏–±–∫–∞!";
                feedback.className = "fca01-quiz-feedback wrong";
            }
            nextBtn.classList.remove('hidden');
        }

        function initMatchGame() {
            const area = root.querySelector('#ex-flashcards-acc-07-learning-area-match');
            selectedMatchCard = null;
            isProcessingMatch = false;

            let fronts = flashcardsData.map((card, index) => ({ text: card.front, type: 'front', id: index }));
            let backs = flashcardsData.map((card, index) => ({ text: card.back, type: 'back', id: index }));

            fronts.sort(() => Math.random() - 0.5);
            backs.sort(() => Math.random() - 0.5);

            area.innerHTML = `
                <div class="fca01-match-container">
                    <p class="fca01-match-feedback"></p>
                    <div class="fca01-match-grid">
                        <div class="fca01-match-col" id="ex-flashcards-acc-07-match-col-fronts"></div>
                        <div class="fca01-match-col" id="ex-flashcards-acc-07-match-col-backs"></div>
                    </div>
                </div>
            `;

            const colFronts = root.querySelector('#ex-flashcards-acc-07-match-col-fronts');
            const colBacks = root.querySelector('#ex-flashcards-acc-07-match-col-backs');

            function createMatchElement(item) {
                const div = document.createElement('div');
                div.className = 'fca01-match-card';
                div.textContent = item.text;
                div.dataset.id = item.id;
                div.dataset.type = item.type;
                div.addEventListener('click', () => handleMatchClick(div));
                return div;
            }

            fronts.forEach(item => colFronts.appendChild(createMatchElement(item)));
            backs.forEach(item => colBacks.appendChild(createMatchElement(item)));
        }

        function handleMatchClick(clickedCard) {
            if (isProcessingMatch || clickedCard.classList.contains('matched')) return;
            if (clickedCard === selectedMatchCard) return;

            const feedbackEl = root.querySelector('.fca01-match-feedback');

            if (!selectedMatchCard) {
                selectedMatchCard = clickedCard;
                clickedCard.classList.add('selected');
                return;
            }

            if (selectedMatchCard.dataset.type === clickedCard.dataset.type) {
                selectedMatchCard.classList.remove('selected');
                selectedMatchCard = clickedCard;
                clickedCard.classList.add('selected');
                return;
            }

            const firstId = selectedMatchCard.dataset.id;
            const secondId = clickedCard.dataset.id;
            const previousCard = selectedMatchCard;

            if (firstId === secondId) {
                previousCard.classList.add('matched');
                clickedCard.classList.add('matched');
                feedbackEl.textContent = "‚ú® –û—Ç–ª–∏—á–Ω–æ!";
                feedbackEl.className = "fca01-match-feedback correct";
                selectedMatchCard = null;
                setTimeout(() => { feedbackEl.textContent = ""; }, 1000);

                const remaining = root.querySelectorAll('.fca01-match-card:not(.matched)').length;
                if (remaining === 0) feedbackEl.textContent = "üéâ –ü–û–ë–ï–î–ê! üéâ";
            } else {
                isProcessingMatch = true;
                clickedCard.classList.add('wrong');
                previousCard.classList.add('wrong');
                feedbackEl.textContent = "–ù–µ–≤–µ—Ä–Ω–æ";
                feedbackEl.className = "fca01-match-feedback wrong";

                setTimeout(() => {
                    clickedCard.classList.remove('selected', 'wrong');
                    previousCard.classList.remove('selected', 'wrong');
                    feedbackEl.textContent = "";
                    isProcessingMatch = false;
                }, 800);

                selectedMatchCard = null;
            }
        }

        pickRuVoice();
        if (!cachedRuVoice) {
            window.speechSynthesis.onvoiceschanged = () => {
                pickRuVoice();
                window.speechSynthesis.onvoiceschanged = null;
            };
        }

        root.querySelectorAll('.fca01-mode-btn').forEach(btn => {
            btn.addEventListener('click', () => switchMode(btn.dataset.mode));
        });

        root.querySelector('#ex-flashcards-acc-07-next-btn').addEventListener('click', nextCard);
        root.querySelector('#ex-flashcards-acc-07-prev-btn').addEventListener('click', prevCard);
        root.querySelector('#ex-flashcards-acc-07-start-quiz-btn').addEventListener('click', renderQuiz);
        root.querySelector('#ex-flashcards-acc-07-reset-match-btn').addEventListener('click', initMatchGame);

        switchMode('study');
    }

    initFlashcardsAcc07(rootEl);
})();
            </script>
        </div>

        <!-- Panel 8 (paid) -->
        <article class="exercise-card" data-status="open" data-target="panel-acc-open-8">
            <span class="exercise-type">Flashcards</span>
            <h3 class="exercise-title">–ü–ê–†–ï–ù–¨ –ú–û–ï–ô –õ–£–ß–®–ï–ô –ü–û–î–†–£–ì–ò</h3>
            <span class="card-subtitle">Nomi ¬∑ 1  declinazioni e aggettivi</span>
        </article>

        <div class="exercise-panel" id="panel-acc-open-8" data-access="public" hidden>
            <section id="ex-flashcards-acc-08">
                <div class="fca01-header">
                    <h2>Il genitivo di appartenenza</h2>
                    <p>Scegliere modalit√†</p>
                </div>

                <div class="fca01-mode-buttons">
                    <button class="fca01-mode-btn active" data-mode="study">ESPLORARE</button>
                    <button class="fca01-mode-btn" data-mode="quiz">QUIZ</button>
                    <button class="fca01-mode-btn" data-mode="match">MATCH</button>
                </div>

                <div id="ex-flashcards-acc-08-section-study" class="fca01-section visible">
                    <div id="ex-flashcards-acc-08-learning-area-study"></div>
                    <div class="fca01-nav">
                        <button id="ex-flashcards-acc-08-prev-btn" class="fca01-btn-nav">‚Üê –ù–∞–∑–∞–¥</button>
                        <span id="ex-flashcards-acc-08-counter" class="fca01-counter">1 / 7</span>
                        <button id="ex-flashcards-acc-08-next-btn" class="btn btn-primary">–í–ø–µ—Ä–µ–¥ ‚Üí</button>
                    </div>
                </div>

                <div id="ex-flashcards-acc-08-section-quiz" class="fca01-section">
                    <div id="ex-flashcards-acc-08-learning-area-quiz"></div>
                    <div class="fca01-center-btn">
                        <button id="ex-flashcards-acc-08-start-quiz-btn" class="btn btn-primary hidden">–ù–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å</button>
                    </div>
                </div>

                <div id="ex-flashcards-acc-08-section-match" class="fca01-section">
                    <div id="ex-flashcards-acc-08-learning-area-match"></div>
                    <div class="fca01-center-btn">
                        <button id="ex-flashcards-acc-08-reset-match-btn" class="btn btn-secondary">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
                    </div>
                </div>
            </section>

            <!-- ‚úÖ –í–ê–ñ–ù–û: —Å–∫—Ä–∏–ø—Ç —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–≤—è–∑–∞–Ω –∫ panel-acc-open-3 -->
            <script type="text/plain" data-lazy-script="panel-acc-open-8">
(() => {
    const rootEl = document.getElementById('ex-flashcards-acc-08');
    if (!rootEl) {
        console.warn('‚ö†Ô∏è Flashcards: Container <div id="ex-flashcards-acc-08"></div> NOT FOUND');
        return;
    }

    function initFlashcardsAcc08(root) {
        const flashcardsData = [
            { front: "–¢–µ–ª–µ—Ñ–æ–Ω (–º–æ—è —Å—Ç–∞—Ä—à–∞—è —Å–µ—Å—Ç—Ä–∞ –ö–∞—Ç—è).", back: "–¢–µ–ª–µ—Ñ–æ–Ω –º–æ–µ–π —Å—Ç–∞—Ä—à–µ–π —Å–µ—Å—Ç—Ä—ã –ö–∞—Ç–∏." },
            { front: "–î–æ–º (–º–æ—è –ª—É—á—à–∞—è –ø–æ–¥—Ä—É–≥–∞ –ê–Ω–Ω–∞).", back: "–î–æ–º –º–æ–µ–π –ª—É—á—à–µ–π –ø–æ–¥—Ä–≥—É–≥–∏ –ê–Ω–Ω—ã." },
            { front: "–ü–æ–¥—É—à–∫–∞ (—Ç–≤–æ—è —Å—Ç–∞—Ä–∞—è –∫–æ—à–∫–∞ –ú—É—Ä–∫–∞).", back: "–ü–æ–¥—É—à–∫–∞ —Ç–≤–æ–µ–π —Å—Ç–∞—Ä–æ–π –∫–æ—à–∫–∏ –ú—É—Ä–∫–∏." },
            { front: "–ú–∞—à–∏–Ω–∞ (–Ω–∞—à–∞ –Ω–æ–≤–∞—è —Å–æ—Å–µ–¥–∫–∞ –ù–∞—Ç–∞—à–∞).", back: "–ú–∞—à–∏–Ω–∞ –Ω–∞—à–µ–π –Ω–æ–≤–æ–π —Å–æ—Å–µ–¥–∫–∏ –ù–∞—Ç–∞—à–∏." },
            { front: "–î–æ—á—å (–µ—ë –ª—é–±–∏–º–∞—è –ø–ª–µ–º—è–Ω–Ω–∏—Ü–∞ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞).", back: "–î–æ—á—å –µ—ë –ª—é–±–∏–º–æ–π –ø–ª–µ–º—è–Ω–Ω–∏—Ü—ã –ê–ª–µ–∫—Å–∞–Ω–¥—Ä—ã." },
            { front: "–ë—Ä–∞—Ç (–µ–≥–æ –Ω–æ–≤–∞—è –¥–µ–≤—É—à–∫–∞ –ú–∞—Ä–∏—è).", back: "–ë—Ä–∞—Ç –µ–≥–æ –Ω–æ–≤–æ–π –¥–µ–≤—É—à–∫–∏ –ú–∞—Ä–∏–∏." },
            { front: "–î—Ä—É–≥ (—Ç–≤–æ—è –ø–µ—Ä–≤–∞—è –∂–µ–Ω–∞ –°–≤–µ—Ç–ª–∞–Ω–∞).", back: "–î—Ä—É–≥ —Ç–≤–æ–µ–π –ø–µ—Ä–≤–æ–π –∂–µ–Ω—ã –°–≤–µ—Ç–ª–∞–Ω—ã" },
            { front: "–ü–∏—Ä–æ–≥ (–º–æ—è –ª—é–±–∏–º–∞—è –±–∞–±—É—à–∫–∞ –ù–∏–Ω–∞).", back: "–ü–∏—Ä–æ–≥ –º–æ–µ–π –ª—é–±–∏–º–æ–π –±–∞–±—É—à–∫–∏ –ù–∏–Ω—ã." }
        ];

        let currentMode = 'study';
        let currentIndex = 0;
        let selectedMatchCard = null;
        let isProcessingMatch = false;
        let cachedRuVoice = null;

        function pickRuVoice() {
            const voices = window.speechSynthesis.getVoices();
            const ruVoice = voices.find(v => v.lang.includes('ru'));
            if (ruVoice) cachedRuVoice = ruVoice;
        }

        function textToSpeech(text, lang = 'ru-RU') {
            if (!('speechSynthesis' in window)) return;
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = lang;
            utterance.rate = 0.9;
            utterance.pitch = 1;
            utterance.volume = 1;
            if (cachedRuVoice) utterance.voice = cachedRuVoice;
            window.speechSynthesis.speak(utterance);
        }

        function playAudio(text, event) {
            event.stopPropagation();
            textToSpeech(text);
        }

        function switchMode(mode) {
            currentMode = mode;
            root.querySelectorAll('.fca01-mode-btn').forEach(btn => btn.classList.remove('active'));
            root.querySelectorAll('.fca01-section').forEach(sec => sec.classList.remove('visible'));
            root.querySelector(`#ex-flashcards-acc-08-section-${mode}`).classList.add('visible');
            root.querySelector(`[data-mode="${mode}"]`).classList.add('active');

            if (mode === 'study') { currentIndex = 0; renderCard(); }
            else if (mode === 'quiz') { renderQuiz(); root.querySelector('#ex-flashcards-acc-08-start-quiz-btn').classList.add('hidden'); }
            else if (mode === 'match') { initMatchGame(); }
        }

        function renderCard() {
            const area = root.querySelector('#ex-flashcards-acc-08-learning-area-study');
            const counter = root.querySelector('#ex-flashcards-acc-08-counter');
            const cardData = flashcardsData[currentIndex];

            counter.textContent = `${currentIndex + 1} / ${flashcardsData.length}`;
            area.innerHTML = `
                <div class="fca01-card-container">
                    <div class="fca01-card">
                        <div class="fca01-card-face fca01-card-front">
                            <button class="fca01-audio-btn" data-text="${cardData.front}">üîä</button>
                            ${cardData.front}
                        </div>
                        <div class="fca01-card-face fca01-card-back">
                            <button class="fca01-audio-btn" data-text="${cardData.back}">üîä</button>
                            ${cardData.back}
                        </div>
                    </div>
                </div>
            `;

            const card = area.querySelector('.fca01-card');
            card.addEventListener('click', function() {
                this.classList.toggle('is-flipped');
            });

            area.querySelectorAll('.fca01-audio-btn').forEach(btn => {
                btn.addEventListener('click', (e) => playAudio(btn.dataset.text, e));
            });
        }

        function nextCard() {
            currentIndex = (currentIndex + 1) % flashcardsData.length;
            renderCard();
        }

        function prevCard() {
            currentIndex = currentIndex > 0 ? currentIndex - 1 : flashcardsData.length - 1;
            renderCard();
        }

        function renderQuiz() {
            const area = root.querySelector('#ex-flashcards-acc-08-learning-area-quiz');
            root.querySelector('#ex-flashcards-acc-08-start-quiz-btn').classList.add('hidden');

            const randomIndex = Math.floor(Math.random() * flashcardsData.length);
            const correctCard = flashcardsData[randomIndex];

            let options = [correctCard];
            while (options.length < 3 && options.length < flashcardsData.length) {
                const randomWrong = flashcardsData[Math.floor(Math.random() * flashcardsData.length)];
                if (!options.some(opt => opt.back === randomWrong.back)) options.push(randomWrong);
            }
            options.sort(() => Math.random() - 0.5);

            const buttonsHTML = options.map(opt =>
                `<button class="fca01-quiz-option" data-answer="${opt.back}" data-correct="${correctCard.back}">
                    ${opt.back}
                </button>`
            ).join('');

            area.innerHTML = `
                <div class="fca01-quiz-area">
                    <h3 class="fca01-quiz-question">–ù–∞–π–¥–∏ –≤—Ç–æ—Ä—É—é —á–∞—Å—Ç—å: <br><span class="highlight">"${correctCard.front}"</span></h3>
                    <div class="fca01-quiz-options">${buttonsHTML}</div>
                    <p class="fca01-quiz-feedback"></p>
                </div>
            `;

            area.querySelectorAll('.fca01-quiz-option').forEach(btn => {
                btn.addEventListener('click', function() {
                    checkQuizAnswer(this.dataset.answer, this.dataset.correct, this);
                });
            });
        }

        function checkQuizAnswer(selected, correct, btnElement) {
            const feedback = root.querySelector('.fca01-quiz-feedback');
            const nextBtn = root.querySelector('#ex-flashcards-acc-08-start-quiz-btn');

            root.querySelectorAll('.fca01-quiz-option').forEach(btn => {
                btn.style.pointerEvents = 'none';
                if (btn.dataset.answer === correct) btn.classList.add('correct');
            });

            if (selected === correct) {
                feedback.textContent = "‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ!";
                feedback.className = "fca01-quiz-feedback correct";
            } else {
                btnElement.classList.add('wrong');
                feedback.textContent = "‚ùå –û—à–∏–±–∫–∞!";
                feedback.className = "fca01-quiz-feedback wrong";
            }
            nextBtn.classList.remove('hidden');
        }

        function initMatchGame() {
            const area = root.querySelector('#ex-flashcards-acc-08-learning-area-match');
            selectedMatchCard = null;
            isProcessingMatch = false;

            let fronts = flashcardsData.map((card, index) => ({ text: card.front, type: 'front', id: index }));
            let backs = flashcardsData.map((card, index) => ({ text: card.back, type: 'back', id: index }));

            fronts.sort(() => Math.random() - 0.5);
            backs.sort(() => Math.random() - 0.5);

            area.innerHTML = `
                <div class="fca01-match-container">
                    <p class="fca01-match-feedback"></p>
                    <div class="fca01-match-grid">
                        <div class="fca01-match-col" id="ex-flashcards-acc-08-match-col-fronts"></div>
                        <div class="fca01-match-col" id="ex-flashcards-acc-08-match-col-backs"></div>
                    </div>
                </div>
            `;

            const colFronts = root.querySelector('#ex-flashcards-acc-08-match-col-fronts');
            const colBacks = root.querySelector('#ex-flashcards-acc-08-match-col-backs');

            function createMatchElement(item) {
                const div = document.createElement('div');
                div.className = 'fca01-match-card';
                div.textContent = item.text;
                div.dataset.id = item.id;
                div.dataset.type = item.type;
                div.addEventListener('click', () => handleMatchClick(div));
                return div;
            }

            fronts.forEach(item => colFronts.appendChild(createMatchElement(item)));
            backs.forEach(item => colBacks.appendChild(createMatchElement(item)));
        }

        function handleMatchClick(clickedCard) {
            if (isProcessingMatch || clickedCard.classList.contains('matched')) return;
            if (clickedCard === selectedMatchCard) return;

            const feedbackEl = root.querySelector('.fca01-match-feedback');

            if (!selectedMatchCard) {
                selectedMatchCard = clickedCard;
                clickedCard.classList.add('selected');
                return;
            }

            if (selectedMatchCard.dataset.type === clickedCard.dataset.type) {
                selectedMatchCard.classList.remove('selected');
                selectedMatchCard = clickedCard;
                clickedCard.classList.add('selected');
                return;
            }

            const firstId = selectedMatchCard.dataset.id;
            const secondId = clickedCard.dataset.id;
            const previousCard = selectedMatchCard;

            if (firstId === secondId) {
                previousCard.classList.add('matched');
                clickedCard.classList.add('matched');
                feedbackEl.textContent = "‚ú® –û—Ç–ª–∏—á–Ω–æ!";
                feedbackEl.className = "fca01-match-feedback correct";
                selectedMatchCard = null;
                setTimeout(() => { feedbackEl.textContent = ""; }, 1000);

                const remaining = root.querySelectorAll('.fca01-match-card:not(.matched)').length;
                if (remaining === 0) feedbackEl.textContent = "üéâ –ü–û–ë–ï–î–ê! üéâ";
            } else {
                isProcessingMatch = true;
                clickedCard.classList.add('wrong');
                previousCard.classList.add('wrong');
                feedbackEl.textContent = "–ù–µ–≤–µ—Ä–Ω–æ";
                feedbackEl.className = "fca01-match-feedback wrong";

                setTimeout(() => {
                    clickedCard.classList.remove('selected', 'wrong');
                    previousCard.classList.remove('selected', 'wrong');
                    feedbackEl.textContent = "";
                    isProcessingMatch = false;
                }, 800);

                selectedMatchCard = null;
            }
        }

        pickRuVoice();
        if (!cachedRuVoice) {
            window.speechSynthesis.onvoiceschanged = () => {
                pickRuVoice();
                window.speechSynthesis.onvoiceschanged = null;
            };
        }

        root.querySelectorAll('.fca01-mode-btn').forEach(btn => {
            btn.addEventListener('click', () => switchMode(btn.dataset.mode));
        });

        root.querySelector('#ex-flashcards-acc-08-next-btn').addEventListener('click', nextCard);
        root.querySelector('#ex-flashcards-acc-08-prev-btn').addEventListener('click', prevCard);
        root.querySelector('#ex-flashcards-acc-08-start-quiz-btn').addEventListener('click', renderQuiz);
        root.querySelector('#ex-flashcards-acc-08-reset-match-btn').addEventListener('click', initMatchGame);

        switchMode('study');
    }

    initFlashcardsAcc08(rootEl);
})();
            </script>
        </div>

        <!-- Panel 9 (paid) -->
        <article class="exercise-card" data-status="open" data-target="panel-acc-open-9">
            <span class="exercise-type">Flashcards</span>
            <h3 class="exercise-title">–î–†–£–ì –¢–í–û–ï–ì–û –°–¢–ê–†–®–ï–ì–û –ë–†–ê–¢–ê</h3>
            <span class="card-subtitle">Nomi ¬∑ 2¬∞ e 3¬∞ declinazioni e aggettivi</span>
           
        </article>

        <div class="exercise-panel" id="panel-acc-open-9" data-access="paid" hidden>
            <section id="ex-flashcards-acc-09">
                <div class="fca01-header">
                    <h2>Il genitivo di appartenenza</h2>
                    <p>Scegliere modalit√†</p>
                </div>

                <div class="fca01-mode-buttons">
                    <button class="fca01-mode-btn active" data-mode="study">ESPLORARE</button>
                    <button class="fca01-mode-btn" data-mode="quiz">QUIZ</button>
                    <button class="fca01-mode-btn" data-mode="match">MATCH</button>
                </div>

                <div id="ex-flashcards-acc-09-section-study" class="fca01-section visible">
                    <div id="ex-flashcards-acc-09-learning-area-study"></div>
                    <div class="fca01-nav">
                        <button id="ex-flashcards-acc-09-prev-btn" class="fca01-btn-nav">‚Üê –ù–∞–∑–∞–¥</button>
                        <span id="ex-flashcards-acc-09-counter" class="fca01-counter">1 / 7</span>
                        <button id="ex-flashcards-acc-09-next-btn" class="btn btn-primary">–í–ø–µ—Ä–µ–¥ ‚Üí</button>
                    </div>
                </div>

                <div id="ex-flashcards-acc-09-section-quiz" class="fca01-section">
                    <div id="ex-flashcards-acc-09-learning-area-quiz"></div>
                    <div class="fca01-center-btn">
                        <button id="ex-flashcards-acc-09-start-quiz-btn" class="btn btn-primary hidden">–ù–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å</button>
                    </div>
                </div>

                <div id="ex-flashcards-acc-09-section-match" class="fca01-section">
                    <div id="ex-flashcards-acc-09-learning-area-match"></div>
                    <div class="fca01-center-btn">
                        <button id="ex-flashcards-acc-09-reset-match-btn" class="btn btn-secondary">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
                    </div>
                </div>
            </section>

            <script type="text/plain" data-lazy-script="panel-acc-open-9">
(() => {
    const rootEl = document.getElementById('ex-flashcards-acc-09');
    if (!rootEl) {
        console.warn('‚ö†Ô∏è Flashcards: Container #ex-flashcards-acc-09 NOT FOUND');
        return;
    }

    function initFlashcardsAcc09(root) {
        const flashcardsData = [
            { front: "–ñ–µ–Ω–∞ (–º–æ–π —Å—Ç–∞—Ä—à–∏–π –±—Ä–∞—Ç –ê–ª–µ–∫—Å–∞–Ω–¥—Ä).", back: "–ñ–µ–Ω–∞ –º–æ–µ–≥–æ —Å—Ç–∞—Ä—à–µ–≥–æ –±—Ä–∞—Ç–∞ –ê–ª–µ–∫—Å–∞–¥—Ä–∞." },
            { front: "–î—Ä—É–≥ (—Ç–≤–æ–π –º–ª–∞–¥—à–∏–π –±—Ä–∞—Ç –ê–Ω–¥—Ä–µ–π).", back: "–î—Ä—É–≥ —Ç–≤–æ–µ–≥–æ –º–ª–∞–¥—à–µ–≥–æ –±—Ä–∞—Ç–∞ –ê–Ω–¥—Ä–µ—è" },
            { front: "–î–µ–≤—É—à–∫–∞ (–Ω–∞—à –¥—Ä—É–≥ –í–∏–∫—Ç–æ—Ä).", back: "–î–µ–≤—É—à–∫–∞ –Ω–∞—à–µ–≥–æ –¥—Ä—É–≥–∞ –í–∏–∫—Ç–æ—Ä–∞." },
            { front: "–î–æ–º (–µ–≥–æ –º–∞—Ç—å –ê–Ω–Ω–∞)", back: "–î–æ–º –µ–≥–æ –º–∞—Ç–µ—Ä–∏ –ê–Ω–Ω—ã." },
            { front: "–ë—Ä–∞—Ç (–µ—ë –≤—Ç–æ—Ä–æ–π –º—É–∂ –ê–Ω–∞—Ç–æ–ª–∏–π).", back: "–ë—Ä–∞—Ç –µ—ë –≤—Ç–æ—Ä–æ–≥–æ –º—É–∂–∞ –ê–Ω–∞—Ç–æ–ª–∏—è." },
            { front: "–ú–∏—Å–∫–∞ (–≤–∞—à –ª—é–±–∏–º—ã–π –∫–æ—Ç –ë–∞—Ä—Å–∏–∫)", back: "–ú–∏—Å–∫–∞ –≤–∞—à–µ–≥–æ –ª—é–±–∏–º–æ–≥–æ –∫–æ—Ç–∞ –ë–∞—Ä—Å–∏–∫–∞" },
            { front: "–ü–∞—Ä–µ–Ω—å (–∏—Ö —Å—Ç–∞—Ä—à–∞—è –¥–æ—á—å –ú–∞—Ä–∏—è)", back: "–ü–∞—Ä–µ–Ω—å –∏—Ö —Å—Ç–∞—Ä—à–µ–π –¥–æ—á–µ—Ä–∏ –ú–∞—Ä–∏–∏." }
        ];

        let currentMode = 'study';
        let currentIndex = 0;
        let selectedMatchCard = null;
        let isProcessingMatch = false;
        let cachedRuVoice = null;

        function pickRuVoice() {
            const voices = window.speechSynthesis.getVoices();
            const ruVoice = voices.find(v => v.lang.includes('ru'));
            if (ruVoice) cachedRuVoice = ruVoice;
        }

        function textToSpeech(text, lang = 'ru-RU') {
            if (!('speechSynthesis' in window)) return;
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = lang;
            utterance.rate = 0.9;
            utterance.pitch = 1;
            utterance.volume = 1;
            if (cachedRuVoice) utterance.voice = cachedRuVoice;
            window.speechSynthesis.speak(utterance);
        }

        function playAudio(text, event) {
            event.stopPropagation();
            textToSpeech(text);
        }

        function switchMode(mode) {
            currentMode = mode;
            root.querySelectorAll('.fca01-mode-btn').forEach(btn => btn.classList.remove('active'));
            root.querySelectorAll('.fca01-section').forEach(sec => sec.classList.remove('visible'));
            root.querySelector(`#ex-flashcards-acc-09-section-${mode}`).classList.add('visible');
            root.querySelector(`[data-mode="${mode}"]`).classList.add('active');

            if (mode === 'study') { currentIndex = 0; renderCard(); }
            else if (mode === 'quiz') { renderQuiz(); root.querySelector('#ex-flashcards-acc-09-start-quiz-btn').classList.add('hidden'); }
            else if (mode === 'match') { initMatchGame(); }
        }

        function renderCard() {
            const area = root.querySelector('#ex-flashcards-acc-09-learning-area-study');
            const counter = root.querySelector('#ex-flashcards-acc-09-counter');
            const cardData = flashcardsData[currentIndex];

            counter.textContent = `${currentIndex + 1} / ${flashcardsData.length}`;
            area.innerHTML = `
                <div class="fca01-card-container">
                    <div class="fca01-card">
                        <div class="fca01-card-face fca01-card-front">
                            <button class="fca01-audio-btn" data-text="${cardData.front}">üîä</button>
                            ${cardData.front}
                        </div>
                        <div class="fca01-card-face fca01-card-back">
                            <button class="fca01-audio-btn" data-text="${cardData.back}">üîä</button>
                            ${cardData.back}
                        </div>
                    </div>
                </div>
            `;

            const card = area.querySelector('.fca01-card');
            card.addEventListener('click', function() {
                this.classList.toggle('is-flipped');
            });

            area.querySelectorAll('.fca01-audio-btn').forEach(btn => {
                btn.addEventListener('click', (e) => playAudio(btn.dataset.text, e));
            });
        }

        function nextCard() {
            currentIndex = (currentIndex + 1) % flashcardsData.length;
            renderCard();
        }

        function prevCard() {
            currentIndex = currentIndex > 0 ? currentIndex - 1 : flashcardsData.length - 1;
            renderCard();
        }

        function renderQuiz() {
            const area = root.querySelector('#ex-flashcards-acc-09-learning-area-quiz');
            root.querySelector('#ex-flashcards-acc-09-start-quiz-btn').classList.add('hidden');

            const randomIndex = Math.floor(Math.random() * flashcardsData.length);
            const correctCard = flashcardsData[randomIndex];

            let options = [correctCard];
            while (options.length < 3 && options.length < flashcardsData.length) {
                const randomWrong = flashcardsData[Math.floor(Math.random() * flashcardsData.length)];
                if (!options.some(opt => opt.back === randomWrong.back)) options.push(randomWrong);
            }
            options.sort(() => Math.random() - 0.5);

            const buttonsHTML = options.map(opt =>
                `<button class="fca01-quiz-option" data-answer="${opt.back}" data-correct="${correctCard.back}">
                    ${opt.back}
                </button>`
            ).join('');

            area.innerHTML = `
                <div class="fca01-quiz-area">
                    <h3 class="fca01-quiz-question">–ù–∞–π–¥–∏ –≤—Ç–æ—Ä—É—é —á–∞—Å—Ç—å: <br><span class="highlight">"${correctCard.front}"</span></h3>
                    <div class="fca01-quiz-options">${buttonsHTML}</div>
                    <p class="fca01-quiz-feedback"></p>
                </div>
            `;

            area.querySelectorAll('.fca01-quiz-option').forEach(btn => {
                btn.addEventListener('click', function() {
                    checkQuizAnswer(this.dataset.answer, this.dataset.correct, this);
                });
            });
        }

        function checkQuizAnswer(selected, correct, btnElement) {
            const feedback = root.querySelector('.fca01-quiz-feedback');
            const nextBtn = root.querySelector('#ex-flashcards-acc-09-start-quiz-btn');

            root.querySelectorAll('.fca01-quiz-option').forEach(btn => {
                btn.style.pointerEvents = 'none';
                if (btn.dataset.answer === correct) btn.classList.add('correct');
            });

            if (selected === correct) {
                feedback.textContent = "‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ!";
                feedback.className = "fca01-quiz-feedback correct";
            } else {
                btnElement.classList.add('wrong');
                feedback.textContent = "‚ùå –û—à–∏–±–∫–∞!";
                feedback.className = "fca01-quiz-feedback wrong";
            }
            nextBtn.classList.remove('hidden');
        }

        function initMatchGame() {
            const area = root.querySelector('#ex-flashcards-acc-09-learning-area-match');
            selectedMatchCard = null;
            isProcessingMatch = false;

            let fronts = flashcardsData.map((card, index) => ({ text: card.front, type: 'front', id: index }));
            let backs = flashcardsData.map((card, index) => ({ text: card.back, type: 'back', id: index }));

            fronts.sort(() => Math.random() - 0.5);
            backs.sort(() => Math.random() - 0.5);

            area.innerHTML = `
                <div class="fca01-match-container">
                    <p class="fca01-match-feedback"></p>
                    <div class="fca01-match-grid">
                        <div class="fca01-match-col" id="ex-flashcards-acc-09-match-col-fronts"></div>
                        <div class="fca01-match-col" id="ex-flashcards-acc-09-match-col-backs"></div>
                    </div>
                </div>
            `;

            const colFronts = root.querySelector('#ex-flashcards-acc-09-match-col-fronts');
            const colBacks = root.querySelector('#ex-flashcards-acc-09-match-col-backs');

            function createMatchElement(item) {
                const div = document.createElement('div');
                div.className = 'fca01-match-card';
                div.textContent = item.text;
                div.dataset.id = item.id;
                div.dataset.type = item.type;
                div.addEventListener('click', () => handleMatchClick(div));
                return div;
            }

            fronts.forEach(item => colFronts.appendChild(createMatchElement(item)));
            backs.forEach(item => colBacks.appendChild(createMatchElement(item)));
        }

        function handleMatchClick(clickedCard) {
            if (isProcessingMatch || clickedCard.classList.contains('matched')) return;
            if (clickedCard === selectedMatchCard) return;

            const feedbackEl = root.querySelector('.fca01-match-feedback');

            if (!selectedMatchCard) {
                selectedMatchCard = clickedCard;
                clickedCard.classList.add('selected');
                return;
            }

            if (selectedMatchCard.dataset.type === clickedCard.dataset.type) {
                selectedMatchCard.classList.remove('selected');
                selectedMatchCard = clickedCard;
                clickedCard.classList.add('selected');
                return;
            }

            const firstId = selectedMatchCard.dataset.id;
            const secondId = clickedCard.dataset.id;
            const previousCard = selectedMatchCard;

            if (firstId === secondId) {
                previousCard.classList.add('matched');
                clickedCard.classList.add('matched');
                feedbackEl.textContent = "‚ú® –û—Ç–ª–∏—á–Ω–æ!";
                feedbackEl.className = "fca01-match-feedback correct";
                selectedMatchCard = null;
                setTimeout(() => { feedbackEl.textContent = ""; }, 1000);

                const remaining = root.querySelectorAll('.fca01-match-card:not(.matched)').length;
                if (remaining === 0) feedbackEl.textContent = "üéâ –ü–û–ë–ï–î–ê! üéâ";
            } else {
                isProcessingMatch = true;
                clickedCard.classList.add('wrong');
                previousCard.classList.add('wrong');
                feedbackEl.textContent = "–ù–µ–≤–µ—Ä–Ω–æ";
                feedbackEl.className = "fca01-match-feedback wrong";

                setTimeout(() => {
                    clickedCard.classList.remove('selected', 'wrong');
                    previousCard.classList.remove('selected', 'wrong');
                    feedbackEl.textContent = "";
                    isProcessingMatch = false;
                }, 800);

                selectedMatchCard = null;
            }
        }

        pickRuVoice();
        if (!cachedRuVoice) {
            window.speechSynthesis.onvoiceschanged = () => {
                pickRuVoice();
                window.speechSynthesis.onvoiceschanged = null;
            };
        }

        root.querySelectorAll('.fca01-mode-btn').forEach(btn => {
            btn.addEventListener('click', () => switchMode(btn.dataset.mode));
        });

        root.querySelector('#ex-flashcards-acc-09-next-btn').addEventListener('click', nextCard);
        root.querySelector('#ex-flashcards-acc-09-prev-btn').addEventListener('click', prevCard);
        root.querySelector('#ex-flashcards-acc-09-start-quiz-btn').addEventListener('click', renderQuiz);
        root.querySelector('#ex-flashcards-acc-09-reset-match-btn').addEventListener('click', initMatchGame);

        switchMode('study');
    }

    initFlashcardsAcc09(rootEl);
})();
            </script>
        </div>

        <!-- Panel 10 (paid) -->
        <article class="exercise-card" data-status="open" data-target="panel-acc-open-10">
            <span class="exercise-type">Flashcards</span>
            <h3 class="exercise-title">–°–ï–ú–¨–Ø –ê–õ–¨–ë–ï–†–¢–ê</h3>
            <span class="card-subtitle">Il genitivo</span>
        </article>

        <div class="exercise-panel" id="panel-acc-open-10" data-access="paid" hidden>
            <section id="ex-flashcards-acc-10">
                <div class="fca01-header">
                    <h2>Il genitivo: Di chi √®?</h2>
                    <p>Scegliere modalit√†</p>
                </div>

                <div class="fca01-mode-buttons">
                    <button class="fca01-mode-btn active" data-mode="study">ESPLORARE</button>
                    <button class="fca01-mode-btn" data-mode="quiz">QUIZ</button>
                    <button class="fca01-mode-btn" data-mode="match">MATCH</button>
                </div>

                <div id="ex-flashcards-acc-10-section-study" class="fca01-section visible">
                    <div id="ex-flashcards-acc-10-learning-area-study"></div>
                    <div class="fca01-nav">
                        <button id="ex-flashcards-acc-10-prev-btn" class="fca01-btn-nav">‚Üê –ù–∞–∑–∞–¥</button>
                        <span id="ex-flashcards-acc-10-counter" class="fca01-counter">1 / 8</span>
                        <button id="ex-flashcards-acc-10-next-btn" class="btn btn-primary">–í–ø–µ—Ä–µ–¥ ‚Üí</button>
                    </div>
                </div>

                <div id="ex-flashcards-acc-10-section-quiz" class="fca01-section">
                    <div id="ex-flashcards-acc-10-learning-area-quiz"></div>
                    <div class="fca01-center-btn">
                        <button id="ex-flashcards-acc-10-start-quiz-btn" class="btn btn-primary hidden">–ù–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å</button>
                    </div>
                </div>

                <div id="ex-flashcards-acc-10-section-match" class="fca01-section">
                    <div id="ex-flashcards-acc-10-learning-area-match"></div>
                    <div class="fca01-center-btn">
                        <button id="ex-flashcards-acc-10-reset-match-btn" class="btn btn-secondary">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
                    </div>
                </div>
            </section>

            <script type="text/plain" data-lazy-script="panel-acc-open-10">
(() => {
    const rootEl = document.getElementById('ex-flashcards-acc-10');
    if (!rootEl) {
        console.warn('Flashcards: Container #ex-flashcards-acc-10 NOT FOUND');
        return;
    }

    function initFlashcardsAcc10(root) {
        const flashcardsData = [
            { front: "–≠—Ç–æ —Å–µ—Å—Ç—Ä–∞ –ê–ª—å–±–µ—Ä—Ç–∞ - –õ–∏–Ω–¥–∞.", back: "–°–µ—Å—Ç—Ä—É –ê–ª—å–±–µ—Ä—Ç–∞ –∑–æ–≤—É—Ç –õ–∏–Ω–¥–∞." },
            { front: "–≠—Ç–æ –±—Ä–∞—Ç –õ–∏–Ω–¥—ã - –ê–ª—å–±–µ—Ä—Ç.", back: "–ë—Ä–∞—Ç–∞ –õ–∏–Ω–¥—ã –∑–æ–≤—É—Ç –ê–ª—å–±–µ—Ä—Ç." },
            { front: "–≠—Ç–æ –∂–µ–Ω–∞ –í–ª–∞–¥–∏—Å–ª–∞–≤–∞ - –õ–∏–Ω–¥–∞.", back: "–ñ–µ–Ω—É –í–ª–∞–¥–∏—Å–ª–∞–≤–∞ –∑–æ–≤—É—Ç –õ–∏–Ω–¥–∞." },
            { front: "–≠—Ç–æ –º—É–∂ –õ–∏–Ω–¥—ã - –í–ª–∞–¥–∏—Å–ª–∞–≤.", back: "–ú—É–∂–∞ –õ–∏–Ω–¥—ã –∑–æ–≤—É—Ç–í–ª–∞–¥–∏—Å–ª–∞–≤." },
            { front: "–≠—Ç–æ –¥–æ—á—å –í–ª–∞–¥–∏—Å–ª–∞–≤–∞ - –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞.", back: "–î–æ—á—å –í–ª–∞–¥–∏—Å–ª–∞–≤–∞ –∑–æ–≤—É—Ç –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞." },
            { front: "–≠—Ç–æ –í–ª–∞–¥–∏—Å–ª–∞–≤ - –æ—Ç–µ—Ü –ê–ª–µ–∫—Å–∞–Ω–¥—Ä—ã.", back: "–û—Ç—Ü–∞ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä—ã –∑–æ–≤—É—Ç –í–ª–∞–¥–∏—Å–ª–∞–≤." },
            { front: "–≠—Ç–æ –ê–Ω–∞—Ç–æ–ª–∏–π - —Å—ã–Ω –õ–∏–Ω–¥—ã –∏ –í–ª–∞–¥–∏—Å–ª–∞–≤–∞.", back: "–°—ã–Ω–∞ –õ–∏–Ω–¥—ã –∏ –í–ª–∞–¥–∏—Å–ª–∞–≤–∞ –∑–æ–≤—É—Ç –ê–Ω–∞—Ç–æ–ª–∏–π." },
            { front: "–≠—Ç–æ –ê–ª—å–±–µ—Ä—Ç - –¥—è–¥—è –ê–Ω–∞—Ç–æ–ª–∏—è –∏ –ê–ª–µ–∫—Å–∞–Ω–¥—ã.", back: "–î—è–¥—é –ê–Ω–∞—Ç–æ–ª–∏—è –∏ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä—ã –∑–æ–≤—É—Ç –ê–ª—å–±–µ—Ä—Ç." },
            { front: "–≠—Ç–æ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä - –ø–ª–µ–º—è–Ω–Ω–∏–∫ –ê–ª—å–±–µ—Ä—Ç–∞ –∏ –ï–ª–µ–Ω—ã.", back:"–ü–ª–µ–º—è–Ω–Ω–∏–∫–∞ –ê–ª—å–±–µ—Ä—Ç–∞ –∏ –ï–ª–µ–Ω—ã –∑–æ–≤—É—Ç –ê–Ω–∞—Ç–æ–ª–∏–π." },
            { front: "–≠—Ç–æ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞ - –ø–ª–µ–º—è–Ω–Ω–∏—Ü–∞ –ê–ª—å–±–µ—Ä—Ç–∞ –∏ –ï–ª–µ–Ω—ã.", back:"–ü–ª–µ–º—è–Ω–Ω–∏—Ü—É –ê–ª—å–±–µ—Ä—Ç–∞ –∏ –ï–ª–µ–Ω—ã –∑–æ–≤—É—Ç –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞." },
            { front: "–≠—Ç–æ –ï–ª–µ–Ω–∞ - —Ç—ë—Ç—è –ê–Ω–∞—Ç–æ–ª–∏—è –∏ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä—ã.", back: "–¢—ë—Ç—é –ê–Ω–∞—Ç–æ–ª–∏—è –∏ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä—ã –∑–æ–≤—É—Ç –ï–ª–µ–Ω–∞." } 
            ];

        let currentMode = 'study';
        let currentIndex = 0;
        let selectedMatchCard = null;
        let isProcessingMatch = false;
        let cachedRuVoice = null;

        function pickRuVoice() {
            const voices = window.speechSynthesis.getVoices();
            const ruVoice = voices.find(v => v.lang.includes('ru'));
            if (ruVoice) cachedRuVoice = ruVoice;
        }

        function textToSpeech(text, lang = 'ru-RU') {
            if (!('speechSynthesis' in window)) return;
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = lang;
            utterance.rate = 0.9;
            utterance.pitch = 1;
            utterance.volume = 1;
            if (cachedRuVoice) utterance.voice = cachedRuVoice;
            window.speechSynthesis.speak(utterance);
        }

        function playAudio(text, event) {
            event.stopPropagation();
            textToSpeech(text);
        }

        function switchMode(mode) {
            currentMode = mode;
            root.querySelectorAll('.fca01-mode-btn').forEach(btn => btn.classList.remove('active'));
            root.querySelectorAll('.fca01-section').forEach(sec => sec.classList.remove('visible'));
            root.querySelector(`#ex-flashcards-acc-10-section-${mode}`).classList.add('visible');
            root.querySelector(`[data-mode="${mode}"]`).classList.add('active');

            if (mode === 'study') { currentIndex = 0; renderCard(); }
            else if (mode === 'quiz') { renderQuiz(); root.querySelector('#ex-flashcards-acc-10-start-quiz-btn').classList.add('hidden'); }
            else if (mode === 'match') { initMatchGame(); }
        }

        function renderCard() {
            const area = root.querySelector('#ex-flashcards-acc-10-learning-area-study');
            const counter = root.querySelector('#ex-flashcards-acc-10-counter');
            const cardData = flashcardsData[currentIndex];

            counter.textContent = `${currentIndex + 1} / ${flashcardsData.length}`;
            area.innerHTML = `
                <div class="fca01-card-container">
                    <div class="fca01-card">
                        <div class="fca01-card-face fca01-card-front">
                            <button class="fca01-audio-btn" data-text="${cardData.front}">üîä</button>
                            ${cardData.front}
                        </div>
                        <div class="fca01-card-face fca01-card-back">
                            <button class="fca01-audio-btn" data-text="${cardData.back}">üîä</button>
                            ${cardData.back}
                        </div>
                    </div>
                </div>
            `;

            const card = area.querySelector('.fca01-card');
            card.addEventListener('click', function() {
                this.classList.toggle('is-flipped');
            });

            area.querySelectorAll('.fca01-audio-btn').forEach(btn => {
                btn.addEventListener('click', (e) => playAudio(btn.dataset.text, e));
            });
        }

        function nextCard() {
            currentIndex = (currentIndex + 1) % flashcardsData.length;
            renderCard();
        }

        function prevCard() {
            currentIndex = currentIndex > 0 ? currentIndex - 1 : flashcardsData.length - 1;
            renderCard();
        }

        function renderQuiz() {
            const area = root.querySelector('#ex-flashcards-acc-10-learning-area-quiz');
            root.querySelector('#ex-flashcards-acc-10-start-quiz-btn').classList.add('hidden');

            const randomIndex = Math.floor(Math.random() * flashcardsData.length);
            const correctCard = flashcardsData[randomIndex];

            let options = [correctCard];
            while (options.length < 3 && options.length < flashcardsData.length) {
                const randomWrong = flashcardsData[Math.floor(Math.random() * flashcardsData.length)];
                if (!options.some(opt => opt.back === randomWrong.back)) options.push(randomWrong);
            }
            options.sort(() => Math.random() - 0.5);

            const buttonsHTML = options.map(opt =>
                `<button class="fca01-quiz-option" data-answer="${opt.back}" data-correct="${correctCard.back}">
                    ${opt.back}
                </button>`
            ).join('');

            area.innerHTML = `
                <div class="fca01-quiz-area">
                    <h3 class="fca01-quiz-question">–ù–∞–π–¥–∏ –≤—Ç–æ—Ä—É—é —á–∞—Å—Ç—å: <br><span class="highlight">"${correctCard.front}"</span></h3>
                    <div class="fca01-quiz-options">${buttonsHTML}</div>
                    <p class="fca01-quiz-feedback"></p>
                </div>
            `;

            area.querySelectorAll('.fca01-quiz-option').forEach(btn => {
                btn.addEventListener('click', function() {
                    checkQuizAnswer(this.dataset.answer, this.dataset.correct, this);
                });
            });
        }

        function checkQuizAnswer(selected, correct, btnElement) {
            const feedback = root.querySelector('.fca01-quiz-feedback');
            const nextBtn = root.querySelector('#ex-flashcards-acc-10-start-quiz-btn');

            root.querySelectorAll('.fca01-quiz-option').forEach(btn => {
                btn.style.pointerEvents = 'none';
                if (btn.dataset.answer === correct) btn.classList.add('correct');
            });

            if (selected === correct) {
                feedback.textContent = "‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ!";
                feedback.className = "fca01-quiz-feedback correct";
            } else {
                btnElement.classList.add('wrong');
                feedback.textContent = "‚ùå –û—à–∏–±–∫–∞!";
                feedback.className = "fca01-quiz-feedback wrong";
            }
            nextBtn.classList.remove('hidden');
        }

        function initMatchGame() {
            const area = root.querySelector('#ex-flashcards-acc-10-learning-area-match');
            selectedMatchCard = null;
            isProcessingMatch = false;

            let fronts = flashcardsData.map((card, index) => ({ text: card.front, type: 'front', id: index }));
            let backs = flashcardsData.map((card, index) => ({ text: card.back, type: 'back', id: index }));

            fronts.sort(() => Math.random() - 0.5);
            backs.sort(() => Math.random() - 0.5);

            area.innerHTML = `
                <div class="fca01-match-container">
                    <p class="fca01-match-feedback"></p>
                    <div class="fca01-match-grid">
                        <div class="fca01-match-col" id="ex-flashcards-acc-10-match-col-fronts"></div>
                        <div class="fca01-match-col" id="ex-flashcards-acc-10-match-col-backs"></div>
                    </div>
                </div>
            `;

            const colFronts = root.querySelector('#ex-flashcards-acc-10-match-col-fronts');
            const colBacks = root.querySelector('#ex-flashcards-acc-10-match-col-backs');

            function createMatchElement(item) {
                const div = document.createElement('div');
                div.className = 'fca01-match-card';
                div.textContent = item.text;
                div.dataset.id = item.id;
                div.dataset.type = item.type;
                div.addEventListener('click', () => handleMatchClick(div));
                return div;
            }

            fronts.forEach(item => colFronts.appendChild(createMatchElement(item)));
            backs.forEach(item => colBacks.appendChild(createMatchElement(item)));
        }

        function handleMatchClick(clickedCard) {
            if (isProcessingMatch || clickedCard.classList.contains('matched')) return;
            if (clickedCard === selectedMatchCard) return;

            const feedbackEl = root.querySelector('.fca01-match-feedback');

            if (!selectedMatchCard) {
                selectedMatchCard = clickedCard;
                clickedCard.classList.add('selected');
                return;
            }

            if (selectedMatchCard.dataset.type === clickedCard.dataset.type) {
                selectedMatchCard.classList.remove('selected');
                selectedMatchCard = clickedCard;
                clickedCard.classList.add('selected');
                return;
            }

            const firstId = selectedMatchCard.dataset.id;
            const secondId = clickedCard.dataset.id;
            const previousCard = selectedMatchCard;

            if (firstId === secondId) {
                previousCard.classList.add('matched');
                clickedCard.classList.add('matched');
                feedbackEl.textContent = "‚ú® –û—Ç–ª–∏—á–Ω–æ!";
                feedbackEl.className = "fca01-match-feedback correct";
                selectedMatchCard = null;
                setTimeout(() => { feedbackEl.textContent = ""; }, 1000);

                const remaining = root.querySelectorAll('.fca01-match-card:not(.matched)').length;
                if (remaining === 0) feedbackEl.textContent = "üéâ –ü–û–ë–ï–î–ê! üéâ";
            } else {
                isProcessingMatch = true;
                clickedCard.classList.add('wrong');
                previousCard.classList.add('wrong');
                feedbackEl.textContent = "–ù–µ–≤–µ—Ä–Ω–æ";
                feedbackEl.className = "fca01-match-feedback wrong";

                setTimeout(() => {
                    clickedCard.classList.remove('selected', 'wrong');
                    previousCard.classList.remove('selected', 'wrong');
                    feedbackEl.textContent = "";
                    isProcessingMatch = false;
                }, 800);

                selectedMatchCard = null;
            }
        }

        pickRuVoice();
        if (!cachedRuVoice) {
            window.speechSynthesis.onvoiceschanged = () => {
                pickRuVoice();
                window.speechSynthesis.onvoiceschanged = null;
            };
        }

        root.querySelectorAll('.fca01-mode-btn').forEach(btn => {
            btn.addEventListener('click', () => switchMode(btn.dataset.mode));
        });

        root.querySelector('#ex-flashcards-acc-10-next-btn').addEventListener('click', nextCard);
        root.querySelector('#ex-flashcards-acc-10-prev-btn').addEventListener('click', prevCard);
        root.querySelector('#ex-flashcards-acc-10-start-quiz-btn').addEventListener('click', renderQuiz);
        root.querySelector('#ex-flashcards-acc-10-reset-match-btn').addEventListener('click', initMatchGame);

        switchMode('study');
    }

    initFlashcardsAcc10(rootEl);
})();
            </script>
        </div>

        <!-- Panel 4 (public) -->
        <article class="exercise-card" data-status="open" data-target="panel-acc-open-4">
            <span class="exercise-type">Quiz</span>
            <h3 class="exercise-title">QUIZ</h3>
            <span class="card-subtitle"></span>
        </article>

        <div class="exercise-panel" id="panel-acc-open-4" data-access="public" hidden>
            <section id="acc-04-deck">
                <div id="acc-04-cards-container"></div>
                <div class="fca01-nav">
                    <button id="acc-04-deck-prev" class="fca01-btn-nav" disabled>‚Üê –ù–∞–∑–∞–¥</button>
                    <span id="acc-04-deck-counter" class="fca01-counter">1 / 30</span>
                    <button id="acc-04-deck-next" class="btn btn-primary">–í–ø–µ—Ä–µ–¥ ‚Üí</button>
                </div>
            </section>
            <script type="text/plain" data-lazy-script="panel-acc-open-4">
(() => {
    const panel = document.getElementById('panel-acc-open-4');
    if (!panel) return;

    const container = panel.querySelector('#acc-04-cards-container');
    const prevBtn = panel.querySelector('#acc-04-deck-prev');
    const nextBtn = panel.querySelector('#acc-04-deck-next');
    const counterEl = panel.querySelector('#acc-04-deck-counter');

    const TOTAL_CARDS = 30;
    let currentCard = 0;

    const multipleChoiceData = [
        { question: "–ö–∞–∫ –∑–æ–≤—É—Ç (–º–æ–π –±—Ä–∞—Ç) ?", options: ["–ú–æ–µ–≥–æ –±—Ä–∞—Ç–∞", "–ú–æ–π –±—Ä–∞—Ç", "–ú–æ–µ–º—É –±—Ä–∞—Ç—É", "–ú–æ–∏–º –±—Ä–∞—Ç–æ–º"], answer: "–ú–æ–µ–≥–æ –±—Ä–∞—Ç–∞" },
        { question: "–ö–∞–∫ –∑–æ–≤—É—Ç (–Ω–∞—à–∞ —Å–µ—Å—Ç—Ä–∞) ?", options: ["–ù–∞—à—É —Å–µ—Å—Ç—Ä—É", "–ù–∞—à–∞ —Å–µ—Å—Ç—Ä–∞", "–ù–∞—à–µ–π —Å–µ—Å—Ç—Ä–µ"], answer: "–ù–∞—à—É —Å–µ—Å—Ç—Ä—É" },
        { question: "–ö–∞–∫ –∑–æ–≤—É—Ç (–∏—Ö –ø–æ–¥—Ä—É–≥–∞) ?", options: ["–ò—Ö –ø–æ–¥—Ä—É–≥—É", "–ò—Ö –ø–æ–¥—Ä—É–≥–∞", "–ò—Ö –ø–æ–¥—Ä—É–≥–æ–π"], answer: "–ò—Ö –ø–æ–¥—Ä—É–≥—É" },
        { question: "–ö–∞–∫ –∑–æ–≤—É—Ç (–≤–∞—à –æ—Ç–µ—Ü) ?", options: ["–í–∞—à–µ–≥–æ –æ—Ç—Ü–∞", "–í–∞—à –æ—Ç–µ—Ü", "–í–∞—à–µ–º—É –æ—Ç—Ü—É"], answer: "–í–∞—à–µ–≥–æ –æ—Ç—Ü–∞" },
        { question: "–ö–∞–∫ –∑–æ–≤—É—Ç (—Ç–≤–æ—è –º–∞–º–∞) ?", options: ["–¢–≤–æ—é –º–∞–º—É", "–¢–≤–æ—è –º–∞–º–∞", "–¢–≤–æ–µ–π –º–∞–º–µ"], answer: "–¢–≤–æ—é –º–∞–º—É" },
        { question: "–ö–∞–∫ –∑–æ–≤—É—Ç (–µ–≥–æ –¥—Ä—É–≥) ?", options: ["–ï–≥–æ –¥—Ä—É–≥–∞", "–ï–≥–æ –¥—Ä—É–≥", "–ï–≥–æ –¥—Ä—É–≥—É"], answer: "–ï–≥–æ –¥—Ä—É–≥–∞" },
        { question: "–ö–∞–∫ –∑–æ–≤—É—Ç (–µ—ë –¥–æ—á—å) ?", options: ["–ï—ë –¥–æ—á—å", "–ï—ë –¥–æ—á–µ—Ä–∏", "–ï—ë –¥–æ—á–µ—Ä—å—é"], answer: "–ï—ë –¥–æ—á—å" },
        { question: "–ö–∞–∫ –∑–æ–≤—É—Ç (–Ω–∞—à –¥–µ–¥—É—à–∫–∞) ?", options: ["–ù–∞—à–µ–≥–æ –¥–µ–¥—É—à–∫—É", "–ù–∞—à –¥–µ–¥—É—à–∫–∞", "–ù–∞—à–µ–º—É –¥–µ–¥—É—à–∫–µ"], answer: "–ù–∞—à–µ–≥–æ –¥–µ–¥—É—à–∫—É" },
        { question: "–ö–∞–∫ –∑–æ–≤—É—Ç (—Ç–≤–æ–π —Å—ã–Ω) ?", options: ["–¢–≤–æ–µ–≥–æ —Å—ã–Ω–∞", "–¢–≤–æ–π —Å—ã–Ω", "–¢–≤–æ–µ–º—É —Å—ã–Ω—É"], answer: "–¢–≤–æ–µ–≥–æ —Å—ã–Ω–∞" },
        { question: "–ö–∞–∫ –∑–æ–≤—É—Ç (–≤–∞—à–∞ —Ç—ë—Ç—è) ?", options: ["–í–∞—à—É —Ç—ë—Ç—é", "–í–∞—à–∞ —Ç—ë—Ç—è", "–í–∞—à–µ–π —Ç—ë—Ç–µ"], answer: "–í–∞—à—É —Ç—ë—Ç—é" }
    ];

    const matchPairs = [
        { left: "–º–∞–º–∞", right: "–º–∞–º—É" },
        { left: "–±—Ä–∞—Ç", right: "–±—Ä–∞—Ç–∞" },
        { left: "–¥–µ–¥—É—à–∫–∞", right: "–¥–µ–¥—É—à–∫—É" },
        { left: "–ø–æ–¥—Ä—É–≥–∞", right: "–ø–æ–¥—Ä—É–≥—É" },
        { left: "—Å—ã–Ω", right: "—Å—ã–Ω–∞" },
        { left: "—Ç—ë—Ç—è", right: "—Ç—ë—Ç—é" },
        { left: "—Å–µ—Å—Ç—Ä–∞", right: "—Å–µ—Å—Ç—Ä—É" },
        { left: "–¥—Ä—É–≥", right: "–¥—Ä—É–≥–∞" },
        { left: "–±–∞–±—É—à–∫–∞", right: "–±–∞–±—É—à–∫—É" },
        { left: "–¥–æ—á—å", right: "–¥–æ—á—å" }
    ];

    const quizData = [
        { id: "fam-001", promptPrefix: "–ú–æ—è –º–∞–º–∞ ", promptSuffix: " –∑–æ–≤—É—Ç –ê–Ω–Ω–∞.", answers: ["–ú–æ—é –º–∞–º—É"] },
        { id: "fam-002", promptPrefix: "–ú–æ–π –±—Ä–∞—Ç ", promptSuffix: " –∑–æ–≤—É—Ç –ê–ª–µ–∫—Å–∞–Ω–¥—Ä.", answers: ["–ú–æ–µ–≥–æ –±—Ä–∞—Ç–∞"] },
        { id: "fam-003", promptPrefix: "–ï–≥–æ –¥–µ–≤—É—à–∫–∞ ", promptSuffix: " –∑–æ–≤—É—Ç –ï–ª–µ–Ω–∞.", answers: ["–ï–≥–æ –¥–µ–≤—É—à–∫—É"] },
        { id: "fam-004", promptPrefix: "–ù–∞—à –¥–µ–¥—É—à–∫–∞ ", promptSuffix: " –∑–æ–≤—É—Ç –í–ª–∞–¥–∏—Å–ª–∞–≤.", answers: ["–ù–∞—à–µ–≥–æ –¥–µ–¥—É—à–∫—É"] },
        { id: "fam-005", promptPrefix: "–ï—ë –ø–æ–¥—Ä—É–≥–∞ ", promptSuffix: " –∑–æ–≤—É—Ç –ù–∞—Ç–∞–ª—å—è.", answers: ["–ï—ë –ø–æ–¥—Ä—É–≥—É"] },
        { id: "fam-006", promptPrefix: "–ö–∞–∫ –∑–æ–≤—É—Ç —Ç–≤–æ–π –¥—Ä—É–≥ ", promptSuffix: " ?", answers: ["—Ç–≤–æ–µ–≥–æ –¥—Ä—É–≥–∞"] },
        { id: "fam-007", promptPrefix: "–ò—Ö –¥–æ—á—å ", promptSuffix: " –∑–æ–≤—É—Ç –ö–∞—Ç—è.", answers: ["–ò—Ö –¥–æ—á—å"] },
        { id: "fam-008", promptPrefix: "–ù–∞—à —Å—ã–Ω ", promptSuffix: " –∑–æ–≤—É—Ç –ê–Ω–∞—Ç–æ–ª–∏–π.", answers: ["–Ω–∞—à–µ–≥–æ —Å—ã–Ω–∞"] },
        { id: "fam-009", promptPrefix: "–ö–∞–∫ –∑–æ–≤—É—Ç –≤–∞—à–∞ —Ç—ë—Ç—è ", promptSuffix: " ?", answers: ["–≤–∞—à—É —Ç—ë—Ç—é"] },
        { id: "fam-010", promptPrefix: "–¢–≤–æ–π –¥—è–¥—è ", promptSuffix: " - –∑–æ–≤—É—Ç –ê–ª—å–±–µ—Ä—Ç?!", answers: ["—Ç–≤–æ–µ–≥–æ –¥—è–¥—é"] }
    ];

    function normalizeInput(str) {
        return str.trim().replace(/\s+/g, ' ');
    }

    function buildCards() {
        container.innerHTML = '';

        for (let i = 0; i < TOTAL_CARDS; i++) {
            const card = document.createElement('div');
            card.className = 'fca01-card-container acc-04-card';
            card.dataset.index = i;
            if (i === 0) card.classList.add('visible');
            card.hidden = (i !== 0);

            if (i < 10) {
                const item = multipleChoiceData[i];
                const opts = item.options.map(o => `<div class="word-option fca01-quiz-option" draggable="true" data-answer="${o}" data-correct="${item.answer}">${o}</div>`).join('');
                card.innerHTML = `
                    <div class="header">
                        <div class="exercise-counter">Drag & Drop ${i + 1} di 10</div>
                    </div>
                    <div class="instruction">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç</div>
                    <div class="exercise-text">${item.question.replace(/\(([^)]+)\)/, '<span class="gap drop-zone" data-correct="' + item.answer + '"></span>')}</div>
                    <div class="word-options fca01-quiz-options">${opts}</div>
                    <div class="controls">
                        <div class="feedback fca01-quiz-feedback"></div>
                    </div>
                `;
            } else if (i < 20) {
                const pairIdx = i - 10;
                const pair = matchPairs[pairIdx];
                const otherPairs = matchPairs.filter((_, idx) => idx !== pairIdx);
                const shuffledOthers = otherPairs.sort(() => Math.random() - 0.5).slice(0, 2);
                const allPairs = [pair, ...shuffledOthers].sort(() => Math.random() - 0.5);

                let fronts = allPairs.map((p, idx) => ({ text: p.left, id: idx }));
                let backs = allPairs.map((p, idx) => ({ text: p.right, id: idx }));
                fronts.sort(() => Math.random() - 0.5);
                backs.sort(() => Math.random() - 0.5);

                const frontDivs = fronts.map(f => `<div class="fca01-match-card" data-id="${f.id}" data-type="front">${f.text}</div>`).join('');
                const backDivs = backs.map(b => `<div class="fca01-match-card" data-id="${b.id}" data-type="back">${b.text}</div>`).join('');

                card.innerHTML = `
                    <h3 class="quiz-title">Match</h3>
                    <p class="quiz-instruction">–°–æ–ø–æ—Å—Ç–∞–≤—å—Ç–µ –ø–∞—Ä—ã</p>
                    <div class="fca01-match-container">
                        <p class="fca01-match-feedback"></p>
                        <div class="fca01-match-grid">
                            <div class="fca01-match-col">${frontDivs}</div>
                            <div class="fca01-match-col">${backDivs}</div>
                        </div>
                    </div>
                `;
            } else {
                const item = quizData[i - 20];
                card.innerHTML = `
                    <h3 class="quiz-title">Write</h3>
                    <p class="quiz-instruction">Scrivete la forma corretta</p>
                    <div class="quiz-item" data-id="${item.id}">
                        <div class="quiz-prompt">${item.promptPrefix}<input type="text" class="quiz-input" data-index="${i - 20}">${item.promptSuffix}</div>
                        <div class="quiz-controls"><button class="btn btn-primary quiz-check-btn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button></div>
                        <div class="quiz-feedback"></div>
                    </div>
                `;
            }
            container.appendChild(card);
        }
        attachHandlers();
    }

    function attachHandlers() {
        container.querySelectorAll('.fca01-quiz-option[draggable="true"]').forEach(opt => {
            opt.addEventListener('dragstart', function(e) {
                e.dataTransfer.setData('text/plain', this.dataset.answer);
                e.dataTransfer.effectAllowed = 'move';
                this.classList.add('dragging');
            });
            opt.addEventListener('dragend', function() {
                this.classList.remove('dragging');
            });
        });

        container.querySelectorAll('.drop-zone').forEach(zone => {
            zone.addEventListener('dragover', function(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                this.classList.add('drag-over');
            });
            zone.addEventListener('dragleave', function() {
                this.classList.remove('drag-over');
            });
            zone.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('drag-over');
                if (this.classList.contains('filled')) return;

                const answer = e.dataTransfer.getData('text/plain');
                const correct = this.dataset.correct;
                const card = this.closest('.acc-04-card');
                const fb = card.querySelector('.fca01-quiz-feedback');

                this.textContent = answer;
                this.classList.add('filled');

                card.querySelectorAll('.fca01-quiz-option').forEach(o => {
                    o.setAttribute('draggable', 'false');
                    o.style.pointerEvents = 'none';
                    if (o.dataset.answer === correct) o.classList.add('correct');
                });

                if (answer === correct) {
                    this.classList.add('correct');
                    fb.textContent = '‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ!';
                    fb.className = 'fca01-quiz-feedback correct';
                } else {
                    this.classList.add('wrong');
                    fb.textContent = '‚ùå –û—à–∏–±–∫–∞!';
                    fb.className = 'fca01-quiz-feedback wrong';
                }
            });
        });

        container.querySelectorAll('.fca01-match-container').forEach(matchContainer => {
            let selectedCard = null;
            let isProcessing = false;

            matchContainer.querySelectorAll('.fca01-match-card').forEach(matchCard => {
                matchCard.addEventListener('click', function() {
                    if (isProcessing || this.classList.contains('matched')) return;
                    if (this === selectedCard) return;

                    const feedbackEl = matchContainer.querySelector('.fca01-match-feedback');

                    if (!selectedCard) {
                        selectedCard = this;
                        this.classList.add('selected');
                        return;
                    }

                    if (selectedCard.dataset.type === this.dataset.type) {
                        selectedCard.classList.remove('selected');
                        selectedCard = this;
                        this.classList.add('selected');
                        return;
                    }

                    isProcessing = true;
                    const isMatch = selectedCard.dataset.id === this.dataset.id;

                    if (isMatch) {
                        selectedCard.classList.add('matched');
                        this.classList.add('matched');
                        feedbackEl.textContent = '‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ!';
                        feedbackEl.className = 'fca01-match-feedback correct';
                        selectedCard.classList.remove('selected');
                        selectedCard = null;
                        isProcessing = false;

                        const remaining = matchContainer.querySelectorAll('.fca01-match-card:not(.matched)').length;
                        if (remaining === 0) {
                            feedbackEl.textContent = 'üéâ –û—Ç–ª–∏—á–Ω–æ!';
                        }
                    } else {
                        feedbackEl.textContent = '‚ùå –û—à–∏–±–∫–∞!';
                        feedbackEl.className = 'fca01-match-feedback wrong';
                        const prevSelected = selectedCard;
                        const currClicked = this;
                        setTimeout(() => {
                            prevSelected.classList.remove('selected');
                            currClicked.classList.remove('selected');
                            selectedCard = null;
                            isProcessing = false;
                        }, 600);
                    }
                });
            });
        });

        container.querySelectorAll('.quiz-check-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const card = this.closest('.acc-04-card');
                const idx = parseInt(card.dataset.index) - 20;
                const item = quizData[idx];
                const input = card.querySelector('.quiz-input');
                const fb = card.querySelector('.quiz-feedback');
                const userAnswer = normalizeInput(input.value);
                const isCorrect = item.answers.some(ans => userAnswer === ans);
                if (isCorrect) {
                    input.classList.remove('incorrect');
                    input.classList.add('correct');
                    input.disabled = true;
                    this.disabled = true;
                    fb.textContent = '–ü—Ä–∞–≤–∏–ª—å–Ω–æ!';
                    fb.className = 'quiz-feedback correct';
                } else {
                    input.classList.remove('correct');
                    input.classList.add('incorrect');
                    fb.textContent = '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.';
                    fb.className = 'quiz-feedback incorrect';
                }
            });
        });

        container.querySelectorAll('.quiz-input').forEach(input => {
            input.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    const btn = this.closest('.quiz-item').querySelector('.quiz-check-btn');
                    if (btn && !btn.disabled) btn.click();
                }
            });
        });
    }

    function showCard(idx) {
        currentCard = idx;
        container.querySelectorAll('.acc-04-card').forEach((c, i) => {
            c.classList.toggle('visible', i === idx);
            c.hidden = (i !== idx);
        });
        counterEl.textContent = (idx + 1) + ' / ' + TOTAL_CARDS;
        prevBtn.disabled = (idx === 0);
        nextBtn.disabled = (idx === TOTAL_CARDS - 1);
    }

    prevBtn.addEventListener('click', () => { if (currentCard > 0) showCard(currentCard - 1); });
    nextBtn.addEventListener('click', () => { if (currentCard < TOTAL_CARDS - 1) showCard(currentCard + 1); });

    buildCards();
    showCard(0);
})();
            </script>
        </div>

    </main>

    <section class="cta-section">
        <h2 class="cta-title">Sblocca tutti gli esercizi</h2>
        <p class="cta-text">Accedi a tutti gli esercizi di questo argomento e continua a praticare senza limiti.</p>
        <button class="cta-button" data-action="unlock-all">Sblocca ora</button>
    </section>

    <script>
    (function() {
        // ============================================================
        // ACCESS CONTROL - MVP Mock Implementation
        // Page: accusativo-come-ti-chiami
        // ============================================================

        const ACCESS_LEVELS = { public: 1, student: 2, paid: 3 };
        const STORAGE_KEY = 'accessLevel';

        // Determine user access level from URL or localStorage
        function getUserLevel() {
            const params = new URLSearchParams(window.location.search);
            const accessParam = params.get('access');

            // Handle reset
            if (accessParam === 'reset') {
                localStorage.removeItem(STORAGE_KEY);
                return 'public';
            }

            // If URL has valid access parameter, save and use it
            if (accessParam && ACCESS_LEVELS.hasOwnProperty(accessParam)) {
                localStorage.setItem(STORAGE_KEY, accessParam);
                return accessParam;
            }

            // Otherwise read from localStorage, default to public
            return localStorage.getItem(STORAGE_KEY) || 'public';
        }

        // Apply access control to all panels
        function applyAccessControl(userLevel) {
            const userLevelNum = ACCESS_LEVELS[userLevel] || 1;
            const panels = document.querySelectorAll('.exercise-panel[data-access]');

            panels.forEach(panel => {
                const panelAccess = panel.getAttribute('data-access') || 'public';
                const panelLevelNum = ACCESS_LEVELS[panelAccess] || 1;

                if (userLevelNum >= panelLevelNum) {
                    panel.setAttribute('data-state', 'open');
                } else {
                    panel.setAttribute('data-state', 'blocked');
                }
            });

            // Update exercise cards to reflect blocked state
            const cards = document.querySelectorAll('.exercise-card[data-target]');
            cards.forEach(card => {
                const targetId = card.getAttribute('data-target');
                const panel = document.getElementById(targetId);
                if (panel && panel.getAttribute('data-state') === 'blocked') {
                    card.setAttribute('data-card-state', 'blocked');
                } else {
                    card.removeAttribute('data-card-state');
                }
            });
        }

        // Initialize access control
        const userLevel = getUserLevel();
        // applyAccessControl(userLevel);

        // ============================================================
        // PANEL TOGGLE & LAZY SCRIPT EXECUTION
        // ============================================================

        const openCards = document.querySelectorAll('[data-status="open"]');

        openCards.forEach(card => {
            card.addEventListener('click', function(e) {
                if (e.target.closest('button')) return;

                const targetPanelId = this.getAttribute('data-target');
                const targetPanel = document.getElementById(targetPanelId);

                if (!targetPanel) return;

                // Block interaction if panel is blocked
                const panelState = targetPanel.getAttribute('data-state');
                if (panelState === 'blocked') {
                    return; // Do not open or initialize blocked panels
                }

                const isCurrentlyOpen = !targetPanel.hidden;

                document.querySelectorAll('.exercise-panel').forEach(panel => {
                    panel.hidden = true;
                });

                if (!isCurrentlyOpen) {
                    targetPanel.hidden = false;
                    const nextPanelState = targetPanel.hidden ? 'closed' : 'open';
                    targetPanel.setAttribute('data-state', nextPanelState);

                    // Only execute lazy script if panel is open AND not initialized
                    if (nextPanelState === 'open' && !targetPanel.hasAttribute('data-initialized')) {
                        const lazyScript = targetPanel.querySelector('[data-lazy-script]');
                        if (lazyScript) {
                            const scriptCode = lazyScript.textContent;
                            const execScript = document.createElement('script');
                            execScript.textContent = scriptCode;
                            targetPanel.appendChild(execScript);
                            targetPanel.setAttribute('data-initialized', 'true');
                        }
                    }
                }
            });
        });
    })();
    </script>

</body>
</html>
